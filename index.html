<!DOCTYPE html>
<html  lang="zh">
<head>
    <meta charset="utf-8">
<title>Jam&#39;s blog</title>
<meta charset="utf-8" />

<meta name="generator" content="Hexo 3.9.0" />

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Jam&#39;s blog</title>

<meta name="google-site-verification" content="67z1CXZ8AOhImIglgTwqAlneRCHTO6xRJo5NeafDAqw" />
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Jam&#39;s blog">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Jam&#39;s blog">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jam&#39;s blog">



<link rel="alternative" href="/atom.xml" title="Jam&#39;s blog" type="application/atom+xml">



<link rel="icon" href="/images/favicon.ico">


<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.7.2/css/bulma.css">
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:400,600|Source+Code+Pro">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-dark.css">


    
    
    
    <style>body>.footer,body>.navbar,body>.section{opacity:0}</style>
    

    
    
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css">
    

    
    

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css">


    
    
    
    

<link rel="stylesheet" href="/css/back-to-top.css">


    
    

    
    
    
    

    
    
<link rel="stylesheet" href="/css/progressbar.css">
<script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script>

    
    
    

    
    
    
        <script async="" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    

    


<link rel="stylesheet" href="/css/style.css">
<link rel="stylesheet" href="/live2d/waifu.css">
    <!-- <meta name="referrer" content="no-referrer" /> 解决图片过期问题-->
</head>
<body class="is-3-column">
    <nav class="navbar navbar-main">
    <div class="container">
        <div class="navbar-brand is-flex-center">
            <a class="navbar-item navbar-logo" href="/">
            
                <img src="/images/logo.svg" alt="Jam&#39;s blog" height="28">
            
            </a>
        </div>
        <div class="navbar-menu">
            
            <div class="navbar-start">
                
                <a class="navbar-item is-active"
                href="/">主页</a>
                
                <a class="navbar-item"
                href="/archives">归档</a>
                
                <a class="navbar-item"
                href="/categories">分类</a>
                
                <a class="navbar-item"
                href="/tags">标签</a>
                
                <a class="navbar-item"
                href="/message">留言</a>
                
                <a class="navbar-item"
                href="/friend">友链</a>
                
                <a class="navbar-item"
                href="/album">美图</a>
                
                <a class="navbar-item"
                href="/music">影音</a>
                
                <a class="navbar-item"
                href="/about">关于</a>
                
            </div>
            
            <div class="navbar-end">
                
                    
                    
                    <a class="navbar-item" target="_blank" title="Download on GitHub" href="https://github.com/removeif">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                    
                
                
                
                <a class="navbar-item search" title="搜索" href="javascript:;">
                    <i class="fas fa-search"></i>
                </a>
                
            </div>
        </div>
    </div>
</nav>
    
    <section class="section">
        <div class="container">
            <div class="columns">
                <div class="column is-8-tablet is-8-desktop is-6-widescreen has-order-2 column-main">
    <!-- 参考自https://dp2px.com/网站 -->
    <div class="tag is-white" style="font-size:15px;">热门推荐：</div>
    <br>
    <br>
    <div class="tags hot-tags" id = "index_hot_div">
    加载中，稍等几秒...
    </div>


    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-04-03T04:58:37.000Z">2019-04-03</time>
                
                    <span class="display-none-class">e49d827032f6cb93e7c8810434cb3e78</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=e49d827032f6cb93e7c8810434cb3e78>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1529 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/04/03/部署Redis主从服务器-Windows/">部署Redis主从服务器--Windows篇</a>
            
        </h1>
        <div class="content">
            <h2 id="Redis主服务器"><a href="#Redis主服务器" class="headerlink" title="Redis主服务器"></a>Redis主服务器</h2><h3 id="Redis-服务安装"><a href="#Redis-服务安装" class="headerlink" title="Redis 服务安装"></a>Redis 服务安装</h3><img src="http://hemrj.cn/static/images/redis1.png">
<img src="http://hemrj.cn/static/images/redis2.png">
<h4 id="记下安装路径，之后的安装服务等需要用到相关路径"><a href="#记下安装路径，之后的安装服务等需要用到相关路径" class="headerlink" title="记下安装路径，之后的安装服务等需要用到相关路径"></a>记下安装路径，之后的安装服务等需要用到相关路径</h4><img src="http://hemrj.cn/static/images/redis3.png">
<h4 id="安装Redis服务的端口，默认为6379"><a href="#安装Redis服务的端口，默认为6379" class="headerlink" title="安装Redis服务的端口，默认为6379"></a>安装Redis服务的端口，默认为6379</h4><img src="http://hemrj.cn/static/images/redis4.png">
<img src="http://hemrj.cn/static/images/redis5.png">
<img src="http://hemrj.cn/static/images/redis6.png">
<h4 id="Redis安装文件下载"><a href="#Redis安装文件下载" class="headerlink" title="Redis安装文件下载"></a>Redis安装文件下载</h4><img src="http://hemrj.cn/static/images/redis7.jpg">
<h4 id="安装完成，安装后默认创建了一个Windows服务（Redis），但这个是默认的配置，根据项目我们需要自己更改一下相关IP等配置"><a href="#安装完成，安装后默认创建了一个Windows服务（Redis），但这个是默认的配置，根据项目我们需要自己更改一下相关IP等配置" class="headerlink" title="安装完成，安装后默认创建了一个Windows服务（Redis），但这个是默认的配置，根据项目我们需要自己更改一下相关IP等配置"></a>安装完成，安装后默认创建了一个Windows服务（Redis），但这个是默认的配置，根据项目我们需要自己更改一下相关IP等配置</h4><h3 id="Redis-配置文件修改"><a href="#Redis-配置文件修改" class="headerlink" title="Redis 配置文件修改"></a>Redis 配置文件修改</h3><h4 id="需要修改一下几个参数设置-–文件-redis-windows-conf"><a href="#需要修改一下几个参数设置-–文件-redis-windows-conf" class="headerlink" title="需要修改一下几个参数设置  –文件 redis.windows.conf"></a>需要修改一下几个参数设置  –文件 redis.windows.conf</h4><figure class="highlight less hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">bind</span> <span class="hljs-selector-tag">114</span><span class="hljs-selector-class">.114</span><span class="hljs-selector-class">.114</span><span class="hljs-selector-class">.114</span>(服务器地址)</span><br><span class="line"><span class="hljs-selector-tag">dir</span> ./</span><br><span class="line"><span class="hljs-selector-tag">dbfilename</span> <span class="hljs-selector-tag">dump</span><span class="hljs-selector-class">.rdb</span> (缓存文件地址)</span><br><span class="line"><span class="hljs-selector-tag">requirepass</span> <span class="hljs-selector-tag">Xyhis</span>@<span class="hljs-selector-id">#Xyhis</span> (Redis密码)</span><br></pre></td></tr></table></figure>
<h4 id="更改配置文件后，暂时用不了Windows服务（Redis），需要安装新的Redis服务"><a href="#更改配置文件后，暂时用不了Windows服务（Redis），需要安装新的Redis服务" class="headerlink" title="更改配置文件后，暂时用不了Windows服务（Redis），需要安装新的Redis服务"></a>更改配置文件后，暂时用不了Windows服务（Redis），需要安装新的Redis服务</h4><h3 id="安装Redis-Windows服务"><a href="#安装Redis-Windows服务" class="headerlink" title="安装Redis Windows服务"></a>安装Redis Windows服务</h3><h4 id="Win-R-打开命令行"><a href="#Win-R-打开命令行" class="headerlink" title="Win+R 打开命令行"></a>Win+R 打开命令行</h4><h4 id="cd-到安装Redis目录下-以默认安装路径为例"><a href="#cd-到安装Redis目录下-以默认安装路径为例" class="headerlink" title="cd 到安装Redis目录下,以默认安装路径为例"></a>cd 到安装Redis目录下,以默认安装路径为例</h4><figure class="highlight fortran hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\<span class="hljs-function"><span class="hljs-keyword">Program</span></span> Files\Redis</span><br></pre></td></tr></table></figure>
<h4 id="安装服务"><a href="#安装服务" class="headerlink" title="安装服务"></a>安装服务</h4><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Redis&gt;redis-server --service-install redis<span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.conf</span> --loglevel verbose</span><br></pre></td></tr></table></figure>
<img src="http://hemrj.cn/static/images/clipboard.png">
<p>意思是已存在服务，接下来先要卸载原来的redis服务</p>
<h4 id="卸载服务"><a href="#卸载服务" class="headerlink" title="卸载服务"></a>卸载服务</h4><figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server <span class="hljs-comment">--service-uninstall</span></span><br></pre></td></tr></table></figure>
<img src="http://hemrj.cn/static/images/clipboard2.png">
<p>显示已经卸载成功，继续安装<br><figure class="highlight vim hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Redis&gt;redis-server --service-install redis.windows.<span class="hljs-keyword">conf</span> --loglevel <span class="hljs-keyword">verbose</span></span><br><span class="line">[<span class="hljs-number">11696</span>] <span class="hljs-number">15</span> Nov <span class="hljs-number">14</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.534</span> # Granting <span class="hljs-keyword">read</span>/<span class="hljs-keyword">write</span> access <span class="hljs-keyword">to</span> <span class="hljs-string">'NT AUTHORITY\NetworkService'</span> <span class="hljs-keyword">on</span>: <span class="hljs-string">"C:\Program Files\Redis"</span> <span class="hljs-string">"C:\Program Files\Redis\"</span></span><br><span class="line">[<span class="hljs-number">11696</span>] <span class="hljs-number">15</span> Nov <span class="hljs-number">14</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.535</span> # Redis successfully installed <span class="hljs-keyword">as</span> <span class="hljs-keyword">a</span> service.</span><br></pre></td></tr></table></figure></p>
<p>启动Redis服务<br><figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server <span class="hljs-comment">--service-start</span></span><br></pre></td></tr></table></figure></p>
<h4 id="安装成功"><a href="#安装成功" class="headerlink" title="安装成功"></a>安装成功</h4><h4 id="常见报错"><a href="#常见报错" class="headerlink" title="常见报错"></a>常见报错</h4><p>报错，卸载后安装还是报错<br><img src="http://hemrj.cn/static/images/clipboard3.png"><br>这是因为redis-cli还在启动导致不能安装<br><img src="http://hemrj.cn/static/images/clipboard4.png"><br><figure class="highlight awk hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">1</span>）redis-cli.exe  启动cli</span><br><span class="line"><span class="hljs-number">2</span>）shutdown   关闭</span><br><span class="line"><span class="hljs-number">3</span>）<span class="hljs-keyword">exit</span> 离开，返回上一层</span><br><span class="line"><span class="hljs-number">4</span>）重新安装</span><br></pre></td></tr></table></figure></p>
<p>以上全部无效<br>1.使用Redis自带命令登录关闭Redis服务<br><figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> -p <span class="hljs-number">6379</span> shutdown</span><br></pre></td></tr></table></figure></p>
<p>2.bat，创建bat命令结束进程<br><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-builtin-name">set</span> <span class="hljs-attribute">p</span>=redis-cli.exe</span><br><span class="line">taskkill /f /im %p%</span><br></pre></td></tr></table></figure></p>
<p>3.使用完整路径安装(部分老系统电脑使用这个方法)<br><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">redis-server --service-install redis<span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.conf</span> --loglevel verbose</span><br></pre></td></tr></table></figure></p>
<p>4.配置相关环境变量使用(完整路径的改良版)<br><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">redis-server</span> %<span class="hljs-selector-tag">RedisHome</span>%\<span class="hljs-selector-tag">redis</span><span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.conf</span></span><br></pre></td></tr></table></figure></p>
<img src="http://hemrj.cn/static/images/RedisHome.png">
<h3 id="Redis-验证安装"><a href="#Redis-验证安装" class="headerlink" title="Redis 验证安装"></a>Redis 验证安装</h3><h4 id="安装RedisDesktopManager，默认直接下一步安装"><a href="#安装RedisDesktopManager，默认直接下一步安装" class="headerlink" title="安装RedisDesktopManager，默认直接下一步安装"></a>安装RedisDesktopManager，默认直接下一步安装</h4><img src="http://hemrj.cn/static/images/redismanager.png">
<p>填写相关IP信息和密码，能正常连接即可，到此，主服务器配置完毕。</p>
<h2 id="Redis从服务器"><a href="#Redis从服务器" class="headerlink" title="Redis从服务器"></a>Redis从服务器</h2><h3 id="安装Redis-内容和安装主服务器一致，主从服务器区别在于配置文件上的不同"><a href="#安装Redis-内容和安装主服务器一致，主从服务器区别在于配置文件上的不同" class="headerlink" title="安装Redis 内容和安装主服务器一致，主从服务器区别在于配置文件上的不同"></a>安装Redis 内容和安装主服务器一致，主从服务器区别在于配置文件上的不同</h3><h3 id="配置文件修改-redis-windows-conf"><a href="#配置文件修改-redis-windows-conf" class="headerlink" title="配置文件修改 redis.windows.conf"></a>配置文件修改 redis.windows.conf</h3><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">slaveof 114.114.114.114     主服务器Redis IP</span><br><span class="line">masterauth abc123     主服务器Redis密码</span><br></pre></td></tr></table></figure>
<h3 id="安装服务-1"><a href="#安装服务-1" class="headerlink" title="安装服务"></a>安装服务</h3><p>内容和安装主服务器一致</p>
<h2 id="测试主从服务器"><a href="#测试主从服务器" class="headerlink" title="测试主从服务器"></a>测试主从服务器</h2><h3 id="主要测试Redis主从服务安装是否成功，主从是否实现"><a href="#主要测试Redis主从服务安装是否成功，主从是否实现" class="headerlink" title="主要测试Redis主从服务安装是否成功，主从是否实现"></a>主要测试Redis主从服务安装是否成功，主从是否实现</h3><h4 id="主服务器Redis-cd到Redis安装目录"><a href="#主服务器Redis-cd到Redis安装目录" class="headerlink" title="主服务器Redis  cd到Redis安装目录"></a>主服务器Redis  cd到Redis安装目录</h4><figure class="highlight fortran hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:\<span class="hljs-function"><span class="hljs-keyword">Program</span></span> Files\Redis</span><br></pre></td></tr></table></figure>
<h4 id="命令行登录Redis"><a href="#命令行登录Redis" class="headerlink" title="命令行登录Redis"></a>命令行登录Redis</h4><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ redis-cli -h host -p<span class="hljs-built_in"> port </span>-a password</span><br><span class="line">C:\Program Files\Redis&gt;redis-cli.exe -h 127.0.0.1 -p 6379 -a <span class="hljs-string">"123"</span></span><br></pre></td></tr></table></figure>
<h4 id="往主Redis写入数据"><a href="#往主Redis写入数据" class="headerlink" title="往主Redis写入数据"></a>往主Redis写入数据</h4><figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">set</span> <span class="hljs-built_in">name</span> posn</span><br></pre></td></tr></table></figure>
<h4 id="查询数据"><a href="#查询数据" class="headerlink" title="查询数据"></a>查询数据</h4><figure class="highlight applescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">get</span> <span class="hljs-built_in">name</span></span><br></pre></td></tr></table></figure>
<img src="http://hemrj.cn/static/images/redisreadwrite.png">
<h2 id="Redis目录解析"><a href="#Redis目录解析" class="headerlink" title="Redis目录解析"></a>Redis目录解析</h2><h3 id="普通理解的文件用处，需要更详细的可以百度"><a href="#普通理解的文件用处，需要更详细的可以百度" class="headerlink" title="普通理解的文件用处，需要更详细的可以百度"></a>普通理解的文件用处，需要更详细的可以百度</h3><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">dump<span class="hljs-selector-class">.rdb</span>      本地数据文件</span><br><span class="line">EventLog.dll</span><br><span class="line">InstallRedisService.bat</span><br><span class="line">Logs     日志</span><br><span class="line">Redis on Windows Release Notes<span class="hljs-selector-class">.docx</span>     官方文档</span><br><span class="line">Redis on Windows<span class="hljs-selector-class">.docx</span>    				官方文档</span><br><span class="line">Windows Service Documentation<span class="hljs-selector-class">.docx</span>      官方文档</span><br><span class="line">redis-benchmark<span class="hljs-selector-class">.exe</span>           性能测试</span><br><span class="line">redis-benchmark.pdb</span><br><span class="line">redis-check-aof.exe</span><br><span class="line">redis-check-aof.pdb</span><br><span class="line">redis-check-dump<span class="hljs-selector-class">.exe</span>  </span><br><span class="line">redis-check-dump.pdb</span><br><span class="line">redis-cli<span class="hljs-selector-class">.exe</span>                 客户端</span><br><span class="line">redis-cli.pdb</span><br><span class="line">redis-server<span class="hljs-selector-class">.exe</span>              服务端</span><br><span class="line">redis-server.pdb</span><br><span class="line">redis<span class="hljs-selector-class">.windows-service</span><span class="hljs-selector-class">.conf</span>    配置文件</span><br><span class="line">redis<span class="hljs-selector-class">.windows</span><span class="hljs-selector-class">.conf</span>            配置文件</span><br><span class="line">redis<span class="hljs-selector-class">.windowsForSlave</span><span class="hljs-selector-class">.conf</span>    自定义配置文件</span><br><span class="line">temp-<span class="hljs-number">1542164504.18020</span><span class="hljs-selector-class">.rdb</span>     临时数据备份</span><br></pre></td></tr></table></figure>
<h2 id="Redis-常用命令"><a href="#Redis-常用命令" class="headerlink" title="Redis 常用命令"></a>Redis 常用命令</h2><figure class="highlight axapta hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//停止Redis服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> stop</span><br><span class="line"><span class="hljs-comment">//启动Redis服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> start</span><br><span class="line"><span class="hljs-comment">//重启Redis服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> restart    </span><br><span class="line"><span class="hljs-comment">//查看redis进程</span></span><br><span class="line">ps -ef|grep redis</span><br><span class="line"><span class="hljs-comment">//以redis.conf配置文件启动服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> redis.conf</span><br><span class="line"><span class="hljs-comment">//退出登入redis</span></span><br><span class="line">quit</span><br><span class="line"><span class="hljs-comment">//获取redis信息</span></span><br><span class="line">info</span><br><span class="line"><span class="hljs-comment">//安装Redis Windows服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-install redis.windows.conf --loglevel verbose</span><br><span class="line"><span class="hljs-comment">//启动Redis服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-start</span><br><span class="line"><span class="hljs-comment">//清空Redis服务器所有数据</span></span><br><span class="line">redis-cli -h <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span> -p <span class="hljs-number">6379</span> -a <span class="hljs-string">"asd2828"</span>          </span><br><span class="line"><span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span>:<span class="hljs-number">6379</span> flushall</span><br><span class="line"><span class="hljs-comment">//卸载Redis Windows服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-uninstall</span><br><span class="line"><span class="hljs-comment">//停止Redis服务</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-stop</span><br><span class="line"><span class="hljs-comment">//查询命令，</span></span><br><span class="line">sscan BsItem <span class="hljs-number">0</span> match *<span class="hljs-number">9898</span>* <span class="hljs-keyword">count</span> <span class="hljs-number">100000</span></span><br><span class="line">      key(表名)      (模糊查询条件)    (查询数量)</span><br><span class="line"><span class="hljs-comment">//安装命令（带服务名）</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-install redis.windows6379.conf --service-name RedisService6379 --loglevel verbose </span><br><span class="line"><span class="hljs-comment">//卸载命令（带服务名）</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> --service-uninstall --service-name RedisService6379</span><br><span class="line"><span class="hljs-comment">//启动命令（带服务名）</span></span><br><span class="line">redis-<span class="hljs-keyword">server</span> start --service-name RedisService6379</span><br></pre></td></tr></table></figure>
<h2 id="切换服务器bat"><a href="#切换服务器bat" class="headerlink" title="切换服务器bat"></a>切换服务器bat</h2><h3 id="其实redis的指向就只是根据redis-windows-conf来执行，同理，在项目需要多个指向（测试和正式）我们就可以利用批处理来切换，或者可以使用局域网来配置，下面的批处理就是在Redis的目录下复制了一份配置文件命名为redis-windows-test-conf，把里面的直线ip和密码等更换了"><a href="#其实redis的指向就只是根据redis-windows-conf来执行，同理，在项目需要多个指向（测试和正式）我们就可以利用批处理来切换，或者可以使用局域网来配置，下面的批处理就是在Redis的目录下复制了一份配置文件命名为redis-windows-test-conf，把里面的直线ip和密码等更换了" class="headerlink" title="其实redis的指向就只是根据redis.windows.conf来执行，同理，在项目需要多个指向（测试和正式）我们就可以利用批处理来切换，或者可以使用局域网来配置，下面的批处理就是在Redis的目录下复制了一份配置文件命名为redis.windows.test.conf，把里面的直线ip和密码等更换了"></a>其实redis的指向就只是根据redis.windows.conf来执行，同理，在项目需要多个指向（测试和正式）我们就可以利用批处理来切换，或者可以使用局域网来配置，下面的批处理就是在Redis的目录下复制了一份配置文件命名为redis.windows.test.conf，把里面的直线ip和密码等更换了</h3><figure class="highlight ruby hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">@echo off  </span><br><span class="line"><span class="hljs-symbol">:</span>: BatchGotAdmin  </span><br><span class="line"><span class="hljs-symbol">:-------------------------------------</span>  </span><br><span class="line">REM  --&gt; Check <span class="hljs-keyword">for</span> permissions  </span><br><span class="line">&gt;nul <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> <span class="hljs-string">"%SYSTEMROOT%\system32\cacls.exe"</span> <span class="hljs-string">"%SYSTEMROOT%\system32\config\system"</span>  </span><br><span class="line"></span><br><span class="line">REM --&gt; If error flag set, we <span class="hljs-keyword">do</span> <span class="hljs-keyword">not</span> have admin.  </span><br><span class="line"><span class="hljs-keyword">if</span> <span class="hljs-string">'%errorlevel%'</span> NEQ <span class="hljs-string">'0'</span> (  </span><br><span class="line">    echo Requesting administrative privileges...  </span><br><span class="line">    goto UACPrompt  </span><br><span class="line">) <span class="hljs-keyword">else</span> ( goto gotAdmin )  </span><br><span class="line"></span><br><span class="line"><span class="hljs-symbol">:UACPrompt</span>  </span><br><span class="line">    echo Set UAC = CreateObject^(<span class="hljs-string">"Shell.Application"</span>^) &gt; <span class="hljs-string">"%temp%\getadmin.vbs"</span>  </span><br><span class="line">    echo UAC.ShellExecute <span class="hljs-string">"%~s0"</span>, <span class="hljs-string">""</span>, <span class="hljs-string">""</span>, <span class="hljs-string">"runas"</span>, <span class="hljs-number">1</span> <span class="hljs-meta">&gt;&gt; </span><span class="hljs-string">"%temp%\getadmin.vbs"</span>  </span><br><span class="line"></span><br><span class="line">    <span class="hljs-string">"%temp%\getadmin.vbs"</span>  </span><br><span class="line">    exit /B  </span><br><span class="line"></span><br><span class="line"><span class="hljs-symbol">:gotAdmin</span>  </span><br><span class="line">    <span class="hljs-keyword">if</span> exist <span class="hljs-string">"%temp%\getadmin.vbs"</span> ( del <span class="hljs-string">"%temp%\getadmin.vbs"</span> )  </span><br><span class="line">    pushd <span class="hljs-string">"%CD%"</span>  </span><br><span class="line">    CD /D <span class="hljs-string">"%~dp0"</span>  </span><br><span class="line"><span class="hljs-symbol">:--------------------------------------</span>  </span><br><span class="line">@echo off</span><br><span class="line">cd <span class="hljs-symbol">C:</span>\Program Files\Redis</span><br><span class="line">redis-server --service-stop </span><br><span class="line"></span><br><span class="line">redis-server --service-uninstall</span><br><span class="line">redis-server --service-install redis.windows.test.conf --loglevel verbose</span><br><span class="line"></span><br><span class="line">redis-server --service-start</span><br><span class="line">pause</span><br></pre></td></tr></table></figure>
<h3 id="精简后的Redis配置文件"><a href="#精简后的Redis配置文件" class="headerlink" title="精简后的Redis配置文件"></a>精简后的Redis配置文件</h3><figure class="highlight clean hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">############################## REDIS CONFIG BY NINE ################################</span><br><span class="line"></span><br><span class="line"># 地址</span><br><span class="line">bind <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span></span><br><span class="line"># 端口</span><br><span class="line">port <span class="hljs-number">6379</span></span><br><span class="line"># 数据文件保存地址</span><br><span class="line">dir ./</span><br><span class="line"># 数据文件名称</span><br><span class="line">dbfilename dump6379.rdb</span><br><span class="line"># 日志文件保存地址</span><br><span class="line">logfile ./redis_log_6379.txt</span><br><span class="line"># 数据库数量</span><br><span class="line">databases <span class="hljs-number">1</span></span><br><span class="line"># Redis访问密码</span><br><span class="line">requirepass @#Xyhis</span><br><span class="line"># 从缓存需要释放以下两句配置</span><br><span class="line"># slaveof <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-number">6375</span></span><br><span class="line"># masterauth @#Xyhis</span><br><span class="line">tcp-backlog <span class="hljs-number">511</span></span><br><span class="line">timeout <span class="hljs-number">0</span></span><br><span class="line">tcp-keepalive <span class="hljs-number">0</span></span><br><span class="line">loglevel notice</span><br><span class="line">save <span class="hljs-number">900</span> <span class="hljs-number">1</span></span><br><span class="line">save <span class="hljs-number">300</span> <span class="hljs-number">10</span></span><br><span class="line">save <span class="hljs-number">60</span> <span class="hljs-number">10000</span></span><br><span class="line">stop-writes-on-bgsave-error yes</span><br><span class="line">rdbcompression yes</span><br><span class="line">rdbchecksum yes</span><br><span class="line"></span><br><span class="line">slave-serve-stale-data yes</span><br><span class="line">slave-read-only yes</span><br><span class="line">repl-diskless-sync no</span><br><span class="line">repl-diskless-sync-delay <span class="hljs-number">5</span></span><br><span class="line">repl-disable-tcp-nodelay no</span><br><span class="line">slave-priority <span class="hljs-number">100</span></span><br><span class="line">appendonly no</span><br><span class="line">appendfilename <span class="hljs-string">"appendonly.aof"</span></span><br><span class="line">appendfsync everysec</span><br><span class="line">no-appendfsync-on-rewrite no</span><br><span class="line">auto-aof-rewrite-percentage <span class="hljs-number">100</span></span><br><span class="line">auto-aof-rewrite-min-size <span class="hljs-number">64</span>mb</span><br><span class="line">aof-load-truncated yes</span><br><span class="line">lua-time-limit <span class="hljs-number">5000</span></span><br><span class="line">slowlog-log-slower-than <span class="hljs-number">10000</span></span><br><span class="line">slowlog-max-len <span class="hljs-number">128</span></span><br><span class="line">latency-monitor-threshold <span class="hljs-number">0</span></span><br><span class="line">notify-keyspace-events <span class="hljs-string">""</span></span><br><span class="line">hash-max-ziplist-entries <span class="hljs-number">512</span></span><br><span class="line">hash-max-ziplist-value <span class="hljs-number">64</span></span><br><span class="line">list-max-ziplist-entries <span class="hljs-number">512</span></span><br><span class="line">list-max-ziplist-value <span class="hljs-number">64</span></span><br><span class="line">set-max-intset-entries <span class="hljs-number">512</span></span><br><span class="line">zset-max-ziplist-entries <span class="hljs-number">128</span></span><br><span class="line">zset-max-ziplist-value <span class="hljs-number">64</span></span><br><span class="line">hll-sparse-max-bytes <span class="hljs-number">3000</span></span><br><span class="line">activerehashing yes</span><br><span class="line">client-output-buffer-limit normal <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">0</span></span><br><span class="line">client-output-buffer-limit slave <span class="hljs-number">256</span>mb <span class="hljs-number">64</span>mb <span class="hljs-number">60</span></span><br><span class="line">client-output-buffer-limit pubsub <span class="hljs-number">32</span>mb <span class="hljs-number">8</span>mb <span class="hljs-number">60</span></span><br><span class="line">hz <span class="hljs-number">10</span></span><br><span class="line">aof-rewrite-incremental-fsync yes</span><br><span class="line"></span><br><span class="line">############################## REDIS CONFIG BY NINE ################################</span><br></pre></td></tr></table></figure>
        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-17T01:29:27.000Z">2019-10-17</time>
                
                    <span class="display-none-class">a40e22ae39b3b8438c28183c14598fcd</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=a40e22ae39b3b8438c28183c14598fcd>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    7 分钟 读完 (大约 1041 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/17/WindowsOS系统整合，创建自己的系统盘/">WindowsOS系统整合，创建自己的系统盘</a>
            
        </h1>
        <div class="content">
            <h4 id="Windows-OS-相关整合-Window-7-And-Windows-10"><a href="#Windows-OS-相关整合-Window-7-And-Windows-10" class="headerlink" title="Windows OS 相关整合   Window 7 And Windows 10"></a>Windows OS 相关整合   Window 7 And Windows 10</h4><blockquote>
<h6 id="自制MSDN原版-10-IN-1-ISO镜像"><a href="#自制MSDN原版-10-IN-1-ISO镜像" class="headerlink" title="自制MSDN原版 10 IN 1 ISO镜像"></a>自制MSDN原版 10 IN 1 ISO镜像</h6></blockquote>
<blockquote>
<h6 id="Tools-：-Imagex、WimTool、Dism-、MSDN-ISO镜像"><a href="#Tools-：-Imagex、WimTool、Dism-、MSDN-ISO镜像" class="headerlink" title="Tools ： Imagex、WimTool、Dism++、MSDN ISO镜像"></a>Tools ： Imagex、WimTool、Dism++、MSDN ISO镜像</h6></blockquote>
<figure class="highlight livescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">解压ISO文件 </span><br><span class="line">提取出sources-&gt;install.wim </span><br><span class="line">重命名install.wim文件（自定义）</span><br><span class="line">打开WIMtool（管理员）  </span><br><span class="line">菜单<span class="hljs-function">-&gt;</span>删卷和信息<span class="hljs-function">-&gt;</span>浏览(打开提取到的wim文件)</span><br><span class="line">修改映像名称，显示名称，映像描述，显示描述<span class="hljs-function">-&gt;</span>修改映像信息</span><br><span class="line">查看映像信息可以查看包含有多少个映像，映像卷号对应相应的映像</span><br><span class="line">每一个卷号修改了要点修改映像信息进行保存</span><br><span class="line"></span><br><span class="line">以此类推，把所有卷所有需要的映像的信息全部改好。</span><br><span class="line"></span><br><span class="line">记录下哪一个wim文件哪一卷对应的是什么映像</span><br><span class="line"></span><br><span class="line">imagex.exe放置到C:<span class="hljs-string">\Windows\System32目录下</span></span><br><span class="line">打开命令行（管理员）</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">命令模板：imagex /<span class="hljs-keyword">export</span> e:<span class="hljs-string">\win764.wim</span> <span class="hljs-number">1</span> E:<span class="hljs-string">\install.wim</span> /compress maximum</span><br></pre></td></tr></table></figure>
<figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">e</span>:\<span class="hljs-selector-tag">win764</span><span class="hljs-selector-class">.wim</span>：你要合并的<span class="hljs-selector-tag">wim</span>文件也就是第一步提取出来的<span class="hljs-selector-tag">wim</span>文件，这里放在<span class="hljs-selector-tag">e</span>盘根目录下（根据自己情况可自定义）</span><br><span class="line"><span class="hljs-selector-tag">E</span>:\<span class="hljs-selector-tag">install</span><span class="hljs-selector-class">.wim</span>：合并后的新文件（自动创建<span class="hljs-selector-tag">install</span><span class="hljs-selector-class">.wim</span>文件）这里存放在<span class="hljs-selector-tag">E</span>盘根目录（根据自己情况可自定义）</span><br></pre></td></tr></table></figure>
<figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-number">1</span>：这里的<span class="hljs-number">1</span>代表的是你要合并的wim文件的第一卷，假设你要合并的文件有<span class="hljs-number">3</span>卷，则</span><br><span class="line">imagex /export e:\win764<span class="hljs-selector-class">.wim</span> <span class="hljs-number">1</span> E:\install<span class="hljs-selector-class">.wim</span> /compress maximum</span><br><span class="line">imagex /export e:\win764<span class="hljs-selector-class">.wim</span> <span class="hljs-number">2</span> E:\install<span class="hljs-selector-class">.wim</span> /compress maximum</span><br><span class="line">imagex /export e:\win764<span class="hljs-selector-class">.wim</span> <span class="hljs-number">3</span> E:\install<span class="hljs-selector-class">.wim</span> /compress maximum</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>1. windows7 企业版sp1</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件名 : <span class="hljs-type">cn_windows_7_enterprise_with_sp1_x64_dvd_u_677685.iso</span></span><br><span class="line">SHA1 : 9<span class="hljs-type">BA5E85596C2F25BE59F7E96139D83D4CB261A62</span></span><br><span class="line">文件大小 : 3.04<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2011-05-12</span><br><span class="line">LINK : <span class="hljs-type">ed2k</span>://|file|cn_windows_7_enterprise_with_sp1_x64_dvd_u_677685.iso|<span class="hljs-number">3265574912</span>|E9DB2607EA3B3540F3FE2E388F8C53C4|/</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">OS版本</th>
<th style="text-align:center">文件名</th>
<th style="text-align:center">CMD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">win7 企业版sp1</td>
<td style="text-align:center">win7_esp1.wim</td>
<td style="text-align:center">imagex /export e:\win7_esp1.wim 1 E:\install.wim /compress maximum</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="—分—割—线—"><a href="#—分—割—线—" class="headerlink" title="—分—割—线—"></a>—分—割—线—</h6><hr>
<p><strong>2. windows7 4 IN 1版本sp1</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">文件名 : <span class="hljs-type">cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso</span></span><br><span class="line">SHA1 : 2<span class="hljs-type">CE0B2DB34D76ED3F697CE148CB7594432405E23</span></span><br><span class="line">文件大小 : 3.19<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2011-05-12</span><br><span class="line">LINK : <span class="hljs-type">ed2k</span>://|file|cn_windows_7_ultimate_with_sp1_x64_dvd_u_677408.iso|<span class="hljs-number">3420557312</span>|B58548681854236C7939003B583A8078|/</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">OS版本</th>
<th style="text-align:center">文件名</th>
<th>CMD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">win7 家庭普通版sp1</td>
<td style="text-align:center">win7_msp1.wim</td>
<td>imagex /export e:\win7_msp1.wim 1 E:\install.wim /compress maximum</td>
</tr>
<tr>
<td style="text-align:center">win7 家庭高级版sp1</td>
<td style="text-align:center">win7_msp1.wim</td>
<td>imagex /export e:\win7_msp1.wim 2 E:\install.wim /compress maximum</td>
</tr>
<tr>
<td style="text-align:center">win7 专业版sp1</td>
<td style="text-align:center">win7_msp1.wim</td>
<td>imagex /export e:\win7_msp1.wim 3 E:\install.wim /compress maximum</td>
</tr>
<tr>
<td style="text-align:center">win7 旗舰版sp1</td>
<td style="text-align:center">win7_msp1.wim</td>
<td>imagex /export e:\win7_msp1.wim 4 E:\install.wim /compress maximum</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="—分—割—线—-1"><a href="#—分—割—线—-1" class="headerlink" title="—分—割—线—"></a>—分—割—线—</h6><hr>
<p><strong>3. windows10 3 IN 1版本1709</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件名 : <span class="hljs-type">cn_windows_10_multi</span>-edition_vl_version_1709_updated_dec_2017_x64_dvd_100406208.iso</span><br><span class="line">SHA1 : 69<span class="hljs-type">dc07e7b7940121027be4c9b51648fa31d2b6ad</span></span><br><span class="line">文件大小 : 4.66<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2017-12-19</span><br><span class="line">内核版本 : 1709</span><br><span class="line">LINK : <span class="hljs-type">ed2k</span>://|file|cn_windows_10_multi-edition_vl_version_1709_updated_dec_2017_x64_dvd_100406208.iso|<span class="hljs-number">5007116288</span>|<span class="hljs-number">317</span>BDC520FA2DD6005CBA8293EA06DF6|/</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>OS版本</th>
<th>文件名</th>
<th>CMD</th>
</tr>
</thead>
<tbody>
<tr>
<td>win10 教育版1709</td>
<td>win10_mdec1709.wim</td>
<td>imagex /export e:\win10_mdec1709.wim 1 E:\install.wim /compress maximum</td>
</tr>
<tr>
<td>win10 企业版1709</td>
<td>win10_mdec1709.wim</td>
<td>imagex /export e:\win10_mdec1709.wim 2 E:\install.wim /compress maximum</td>
</tr>
<tr>
<td>win10 专业版1709</td>
<td>win10_mdec1709.wim</td>
<td>imagex /export e:\win10_mdec1709.wim 3 E:\install.wim /compress maximum</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="—分—割—线—-2"><a href="#—分—割—线—-2" class="headerlink" title="—分—割—线—"></a>—分—割—线—</h6><hr>
<p><strong>4. windows10 长期服务版2016</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件名 : <span class="hljs-type">cn_windows_10_enterprise_2016_ltsb_x64_dvd_9060409.iso</span></span><br><span class="line">SHA1 : 9<span class="hljs-type">E405E950890D2A196565BCA35E152F9CFAD296D</span></span><br><span class="line">文件大小 : 3.56<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2016-08-11</span><br><span class="line">内核版本 : 1607</span><br><span class="line">LINK : <span class="hljs-type">ed2k</span>://|file|cn_windows_10_enterprise_2016_ltsb_x64_dvd_9060409.iso|<span class="hljs-number">3821895680</span>|FF17FF2D5919E3A560151BBC11C399D1|/</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">OS版本</th>
<th style="text-align:center">文件名</th>
<th style="text-align:center">CMD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">win10 长期服务版1607</td>
<td style="text-align:center">win10_eltsb1607.wim</td>
<td style="text-align:center">imagex /export e:\win10_eltsb1607.wim 1 E:\install.wim /compress maximum</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="—分—割—线—-3"><a href="#—分—割—线—-3" class="headerlink" title="—分—割—线—"></a>—分—割—线—</h6><hr>
<p><strong>5. windows10 S版</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">文件名 : <span class="hljs-type">en_windows_10_s_version_1703_updated_july_2017_x64_dvd_10928916.iso</span></span><br><span class="line">SHA1 : <span class="hljs-type">BBEE654D384AE14BA2B64F149E25DFAEF7D5754B</span></span><br><span class="line">文件大小 : 4.47<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2017-07-27</span><br><span class="line">内核版本 : 1703</span><br><span class="line">LINK :  <span class="hljs-type">ed2k</span>://|file|en_windows_10_s_version_1703_updated_july_2017_x64_dvd_10928916.iso|<span class="hljs-number">4799027200</span>|A953CDE943DF709E8CCA148DA0CCCA79|/</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">OS版本</th>
<th style="text-align:center">文件名</th>
<th style="text-align:center">CMD</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">win10 S版1703</td>
<td style="text-align:center">win10_s1703.wim</td>
<td style="text-align:center">imagex /export e:\win10_s1703.wim 1 E:\install.wim /compress maximum</td>
</tr>
</tbody>
</table>
<hr>
<h6 id="—分—割—线—-4"><a href="#—分—割—线—-4" class="headerlink" title="—分—割—线—"></a>—分—割—线—</h6><hr>
<p><strong>5. windows 10 IN 1 版</strong></p>
<figure class="highlight ada hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">文件名 : _<span class="hljs-type">NINTH.iso</span></span><br><span class="line">文件大小 : 10.5<span class="hljs-type">GB</span></span><br><span class="line">发布时间 : 2018-04-18</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th style="text-align:center">OS版本</th>
<th>文件名</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">win7 企业版sp1</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win7 家庭普通版sp1</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win7 家庭高级版sp1</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win7 专业版sp1</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win7 旗舰版sp1</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win10 教育版1709</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win10 企业版1709</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win10 专业版1709</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win10 长期服务版1607</td>
<td>install.wim</td>
</tr>
<tr>
<td style="text-align:center">win10 S版1703</td>
<td>install.wim</td>
</tr>
</tbody>
</table>
<figure class="highlight gherkin hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Windows 10 1803</span><br><span class="line">ed2k://|<span class="hljs-string">file</span>|<span class="hljs-string">cn_windows_10_business_editions_version_1803_updated_march_2018_x64_dvd_12063730.iso</span>|<span class="hljs-string">4634574848</span>|<span class="hljs-string">5674B3586C866EB2F47D7736A1FDE27A</span>|<span class="hljs-string">/</span></span><br></pre></td></tr></table></figure>
        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-17T01:27:25.000Z">2019-10-17</time>
                
                    <span class="display-none-class">c9ab847cecfce1728b63bcebc0314df9</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=c9ab847cecfce1728b63bcebc0314df9>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 读完 (大约 272 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/17/制作Visual Studio 2017离线包/">制作Visual Studio 2017离线包</a>
            
        </h1>
        <div class="content">
            <h4 id="制作Visual-Studio-2017离线包"><a href="#制作Visual-Studio-2017离线包" class="headerlink" title="制作Visual Studio 2017离线包"></a>制作Visual Studio 2017离线包</h4><ul>
<li><p>安装文件下载地址</p>
<figure class="highlight dts hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-symbol">https:</span><span class="hljs-comment">//www.visualstudio.com</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>对应版本</p>
</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Version</th>
<th style="text-align:center">File</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Visual Studio Enterprise (企业版)</td>
<td style="text-align:center">vs_enterprise.exe</td>
</tr>
<tr>
<td style="text-align:center">Visual Studio Professional (专业版)</td>
<td style="text-align:center">vs_professional.exe</td>
</tr>
<tr>
<td style="text-align:center">Visual Studio Community (社区版, 免费)</td>
<td style="text-align:center">vs_community.exe</td>
</tr>
</tbody>
</table>
<ul>
<li>命令参数：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Parameter</th>
<th style="text-align:center">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">–layout</td>
<td style="text-align:center">安装文件的下载路径，例如：C:\DataDanZhang\vs2017\offline-en-chs</td>
</tr>
<tr>
<td style="text-align:center">–lang</td>
<td style="text-align:center">语言包。例如需要中文版，则输入参数:- -lang cn-ZH</td>
</tr>
</tbody>
</table>
<ul>
<li>可选语言：</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">Language Coding</th>
<th style="text-align:center">Remarks</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">cs-CZ</td>
<td style="text-align:center">Czech</td>
</tr>
<tr>
<td style="text-align:center">de-DE</td>
<td style="text-align:center">German</td>
</tr>
<tr>
<td style="text-align:center">en-US</td>
<td style="text-align:center">English 英文</td>
</tr>
<tr>
<td style="text-align:center">es-ES</td>
<td style="text-align:center">Spanish</td>
</tr>
<tr>
<td style="text-align:center">fr-FR</td>
<td style="text-align:center">French</td>
</tr>
<tr>
<td style="text-align:center">it-IT</td>
<td style="text-align:center">Italian</td>
</tr>
<tr>
<td style="text-align:center">ja-JP</td>
<td style="text-align:center">Japanese</td>
</tr>
<tr>
<td style="text-align:center">ko-KR</td>
<td style="text-align:center">Korean</td>
</tr>
<tr>
<td style="text-align:center">pl-PL</td>
<td style="text-align:center">Polish</td>
</tr>
<tr>
<td style="text-align:center">pt-BR</td>
<td style="text-align:center">Portuguese - Brazil</td>
</tr>
<tr>
<td style="text-align:center">ru-RU</td>
<td style="text-align:center">Russian</td>
</tr>
<tr>
<td style="text-align:center">tr-TR</td>
<td style="text-align:center">Turkish</td>
</tr>
<tr>
<td style="text-align:center">zh-CN</td>
<td style="text-align:center">Chinese – Simplified 中文简体</td>
</tr>
<tr>
<td style="text-align:center">zh-TW</td>
<td style="text-align:center">Chinese - Traditional 中文繁体</td>
</tr>
</tbody>
</table>
<h5 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h5><p>用管理员身份打开命令行，输入如下命令<br><figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="hljs-symbol">\v</span>s2017<span class="hljs-symbol">\v</span>s_enterprise.exe --layout C:<span class="hljs-symbol">\v</span>s2017<span class="hljs-symbol">\o</span>ffline-en-chs --lang zh-CN</span><br></pre></td></tr></table></figure></p>
<ul>
<li>C:\vs2017\vs_enterprise.exe这段为下载的软件的位置，每个人不一样</li>
<li>此命令为中文版，layout后面问存放的位置，需要英文可以在后面添加英文参数<figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:<span class="hljs-symbol">\v</span>s2017<span class="hljs-symbol">\v</span>s_enterprise.exe --layout C:<span class="hljs-symbol">\v</span>s2017<span class="hljs-symbol">\o</span>ffline-en-chs --lang zh-CN en-US</span><br></pre></td></tr></table></figure>
</li>
</ul>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T07:44:20.000Z">2019-10-16</time>
                
                    <span class="display-none-class">6c0fdb15b98cb6703dc6c91400b70e8b</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=6c0fdb15b98cb6703dc6c91400b70e8b>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 970 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/C-发送邮件DEMO/">C#发送邮件DEMO</a>
            
        </h1>
        <div class="content">
            <p>本文主要介绍桌面程序发送邮件功能，demo下载在文章末尾</p>
<h2 id="C-发送邮件DEMO"><a href="#C-发送邮件DEMO" class="headerlink" title="C#发送邮件DEMO"></a>C#发送邮件DEMO</h2><h3 id="EmailHelp"><a href="#EmailHelp" class="headerlink" title="EmailHelp"></a>EmailHelp</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> Nine.ModelLibrary;</span><br><span class="line"><span class="hljs-keyword">using</span> System;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Configuration;</span><br><span class="line"><span class="hljs-keyword">using</span> System.IO;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Linq;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Net.Mail;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Web.Script.Serialization;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Nine.UnitlLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EmailHelp</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送邮件</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strHost"&gt;</span>发送方发送方服务器地址<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strAccount"&gt;</span>发送方帐号<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strPwd"&gt;</span>发送方密码<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strFrom"&gt;</span>发送方邮件地址<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="to"&gt;</span>接收方邮件地址<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="title"&gt;</span>邮件标题<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="content"&gt;</span>邮件正文内容<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sfile"&gt;</span>邮件附件<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">SendEmail</span>(<span class="hljs-params">EmailModel email</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            SmtpClient smtpClient = <span class="hljs-keyword">new</span> SmtpClient();</span><br><span class="line">            SetDefulValue(email);</span><br><span class="line">            smtpClient.Host = email.SmtpHost; ;<span class="hljs-comment">//指定SMTP服务器</span></span><br><span class="line">            smtpClient.DeliveryMethod = SmtpDeliveryMethod.Network;<span class="hljs-comment">//指定电子邮件发送方式</span></span><br><span class="line">            smtpClient.EnableSsl = <span class="hljs-literal">true</span>;</span><br><span class="line">            <span class="hljs-comment">//是否使用默认凭据，若为false，则使用自定义的证书，就是下面的networkCredential实例对象</span></span><br><span class="line">            smtpClient.UseDefaultCredentials = <span class="hljs-literal">false</span>;</span><br><span class="line">            smtpClient.Credentials = <span class="hljs-keyword">new</span> System.Net.NetworkCredential(email.Account, email.PassWord);<span class="hljs-comment">//用户名和密码</span></span><br><span class="line">            MailAddress sendEailAddress = <span class="hljs-keyword">new</span> MailAddress(email.FromEmamilAddress, <span class="hljs-string">"发件人名称"</span>);</span><br><span class="line">            <span class="hljs-keyword">int</span> Success = <span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; email.ToEmamilAddress.Count(); i++)</span><br><span class="line">            &#123;</span><br><span class="line">                MailMessage mailMessage = <span class="hljs-keyword">new</span> MailMessage(sendEailAddress, <span class="hljs-keyword">new</span> MailAddress(email.ToEmamilAddress[i]))</span><br><span class="line">                &#123;</span><br><span class="line">                    Subject = email.EmialTitle,<span class="hljs-comment">//主题</span></span><br><span class="line">                    Body = email.EmialContent,<span class="hljs-comment">//内容</span></span><br><span class="line">                    BodyEncoding = System.Text.Encoding.UTF8,<span class="hljs-comment">//正文编码</span></span><br><span class="line">                    IsBodyHtml = <span class="hljs-literal">true</span>,<span class="hljs-comment">//设置为HTML格式</span></span><br><span class="line">                    Priority = MailPriority.High<span class="hljs-comment">//优先级</span></span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="hljs-comment">// 添加附件</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (email.File != <span class="hljs-string">""</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mailMessage.Attachments.Add(<span class="hljs-keyword">new</span> Attachment(email.File));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    smtpClient.Send(mailMessage);</span><br><span class="line">                    Success++;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">catch</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-comment">//MessageBox.Show("失败 - "+ smtpClient.Port+ "【端口】");</span></span><br><span class="line">                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">if</span> (i == email.ToEmamilAddress.Count() - <span class="hljs-number">1</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    mailMessage.Dispose();<span class="hljs-comment">//释放资源</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-comment">//finally</span></span><br><span class="line">                <span class="hljs-comment">//&#123;</span></span><br><span class="line">                <span class="hljs-comment">//    mailMessage.Dispose();//释放资源</span></span><br><span class="line">                <span class="hljs-comment">//&#125;</span></span><br><span class="line">            &#125;</span><br><span class="line">            smtpClient.Dispose();</span><br><span class="line">            <span class="hljs-keyword">if</span> (Success == email.ToEmamilAddress.Count())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">SetDefulValue</span>(<span class="hljs-params">EmailModel email</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(email.SmtpHost))</span><br><span class="line">            &#123;</span><br><span class="line">                email.SmtpHost = <span class="hljs-string">"smtp.qq.com"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(email.Account))</span><br><span class="line">            &#123;</span><br><span class="line">                email.Account = <span class="hljs-string">"3270779240"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(email.PassWord))</span><br><span class="line">            &#123;</span><br><span class="line">                email.PassWord = <span class="hljs-string">"XXXXXXXX"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">string</span>.IsNullOrEmpty(email.FromEmamilAddress))</span><br><span class="line">            &#123;</span><br><span class="line">                email.FromEmamilAddress = <span class="hljs-string">"3270779240@qq.com"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JavaScriptSerializer javaScriptSerializer = <span class="hljs-keyword">new</span> JavaScriptSerializer();</span><br><span class="line">        <span class="hljs-keyword">static</span> List&lt;Contacts&gt; ContactsList = <span class="hljs-keyword">new</span> List&lt;Contacts&gt;();</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> EmailModel <span class="hljs-title">GetEmailModel</span>(<span class="hljs-params"><span class="hljs-keyword">bool</span> isIIS, <span class="hljs-keyword">string</span> contactsName</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            List&lt;<span class="hljs-keyword">string</span>&gt; list = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();</span><br><span class="line">            <span class="hljs-comment">//收件人配置文件路径，这个需要在程序的配置文件中进行配置一下</span></span><br><span class="line">            <span class="hljs-comment">//本文的配置路径 &lt;add key="ContactsFileUrl" value="D:\LogDataMonitornine\ContactsConnection.config"/&gt;</span></span><br><span class="line">            <span class="hljs-keyword">string</span> file = ConfigurationManager.AppSettings[<span class="hljs-string">"ContactsFileUrl"</span>].ToString();</span><br><span class="line">            System.IO.FileStream aFile = <span class="hljs-keyword">new</span> System.IO.FileStream(file, System.IO.FileMode.Open, System.IO.FileAccess.Read, FileShare.ReadWrite);</span><br><span class="line">            StreamReader streamReader = <span class="hljs-keyword">new</span> StreamReader(aFile);</span><br><span class="line">            <span class="hljs-comment">//序列化json配置文件</span></span><br><span class="line">            <span class="hljs-keyword">while</span> (!streamReader.EndOfStream)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">string</span> strCurrentRow = streamReader.ReadLine();</span><br><span class="line">                <span class="hljs-keyword">int</span> IndexofA = strCurrentRow.IndexOf(<span class="hljs-string">"&#123;"</span>);</span><br><span class="line">                <span class="hljs-keyword">int</span> IndexofB = strCurrentRow.LastIndexOf(<span class="hljs-string">"&#125;"</span>);</span><br><span class="line">                <span class="hljs-keyword">string</span> contentList = strCurrentRow.Substring(IndexofA, IndexofB - IndexofA + <span class="hljs-number">1</span>);</span><br><span class="line">                Contacts returnData = javaScriptSerializer.Deserialize&lt;Contacts&gt;(contentList);</span><br><span class="line">                ContactsList.Add(returnData);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">string</span> Content;</span><br><span class="line">            <span class="hljs-keyword">string</span> Title;</span><br><span class="line">            <span class="hljs-comment">//通知IIS分组联系人</span></span><br><span class="line">            <span class="hljs-keyword">if</span> (isIIS)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; ContactsList.Count(); i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (ContactsList[i].IsIIS == <span class="hljs-string">"1"</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        list.Add(ContactsList[i].Address.ToString().Trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-comment">//邮件内容</span></span><br><span class="line">                Content = <span class="hljs-string">"服务发布成功 - "</span> + contactsName + DateTime.Now.ToString() + <span class="hljs-string">"发布"</span> + <span class="hljs-string">"\n"</span> + <span class="hljs-string">"请相关人员进行相关测试，代码更新等工作"</span>+<span class="hljs-string">"【本邮件系统自动发送，勿回复】"</span>;</span><br><span class="line">                <span class="hljs-comment">//邮件标题</span></span><br><span class="line">                Title = <span class="hljs-string">"服务发布成功"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-comment">//通知client分组联系人</span></span><br><span class="line">                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; ContactsList.Count(); i++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (ContactsList[i].IsClient == <span class="hljs-string">"1"</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        list.Add(ContactsList[i].Address.ToString().Trim());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                Content = <span class="hljs-string">"客户端发布成功 - "</span> + contactsName + DateTime.Now.ToString() + <span class="hljs-string">"发布"</span> + <span class="hljs-string">"\n"</span> + <span class="hljs-string">"请相关人员进行相关测试，代码更新等工作"</span> + <span class="hljs-string">"【本邮件系统自动发送，勿回复】"</span>;</span><br><span class="line">                Title = <span class="hljs-string">"客户端发布成功"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            EmailModel emailModel = <span class="hljs-keyword">new</span> EmailModel</span><br><span class="line">            &#123;</span><br><span class="line">                EmialContent = Content,</span><br><span class="line">                EmialTitle = Title,</span><br><span class="line">                ToEmamilAddress = list</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="hljs-keyword">return</span> emailModel;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="CS文件"><a href="#CS文件" class="headerlink" title="CS文件"></a>CS文件</h3><figure class="highlight protobuf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//获取收件人信息</span></span><br><span class="line">EmailModel emailModel = UnitlLibrary.EmailHelp.GetEmailModel(<span class="hljs-literal">true</span>, splitString[<span class="hljs-number">4</span>]);</span><br><span class="line"><span class="hljs-comment">//发送邮件</span></span><br><span class="line">Nine.UnitlLibrary.EmailHelp.SendEmail(emailModel)</span><br></pre></td></tr></table></figure>
<h3 id="ContactsConnection-config"><a href="#ContactsConnection-config" class="headerlink" title="ContactsConnection.config"></a>ContactsConnection.config</h3><figure class="highlight perl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//收件人使用了配置文件进行配置</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"1"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"1"</span>&#125;</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"1"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"0"</span>&#125;</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"1"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"1"</span>&#125;</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"0"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"1"</span>&#125;</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"0"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"1"</span>&#125;</span><br><span class="line">&#123;<span class="hljs-string">"Name"</span>: <span class="hljs-string">"xxx"</span>, <span class="hljs-string">"Address"</span>: <span class="hljs-string">"xxx@qq.com"</span>,<span class="hljs-string">"IsIIS"</span>:<span class="hljs-string">"0"</span>,<span class="hljs-string">"IsClient"</span>:<span class="hljs-string">"1"</span>&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Model"><a href="#Model" class="headerlink" title="Model"></a>Model</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> System.Collections.Generic;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Nine.ModelLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">EmailModel</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送方发送方服务器地址</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _smtpHost = <span class="hljs-string">"smtp.qq.com"</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> SmtpHost</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _smtpHost; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _smtpHost = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送方帐号</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _account = <span class="hljs-string">"XXXXXXXXX"</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Account</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _account; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _account = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送方密码</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _passWord = <span class="hljs-string">"XXXXXXXXXX"</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> PassWord</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _passWord; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _passWord = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 发送方邮件地址</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _fromEmamilAddress = <span class="hljs-string">"XXXXXXXXXX@qq.com"</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> FromEmamilAddress</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _fromEmamilAddress; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _fromEmamilAddress = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 接收方邮件地址</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> List&lt;<span class="hljs-keyword">string</span>&gt; _toEmamilAddress = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">string</span>&gt;();</span><br><span class="line">        <span class="hljs-keyword">public</span> List&lt;<span class="hljs-keyword">string</span>&gt; ToEmamilAddress</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _toEmamilAddress; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _toEmamilAddress = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 邮件标题</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _emialTitle = <span class="hljs-string">""</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> EmialTitle</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _emialTitle; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _emialTitle = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 邮件正文内容</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _emialContent = <span class="hljs-string">""</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> EmialContent</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _emialContent; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _emialContent = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 附件</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _file = <span class="hljs-string">""</span>;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> File</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _file; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; _file = <span class="hljs-keyword">value</span>; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>邮件发送 Demo 源码下载 <a href="http://hemrj.cn/%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81DEMO.zip" target="_blank" rel="noopener">http://hemrj.cn/%E9%82%AE%E4%BB%B6%E5%8F%91%E9%80%81DEMO.zip</a></p>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T07:05:13.000Z">2019-10-16</time>
                
                    <span class="display-none-class">4dc8f7fd8dbdb33b117819fcda561b49</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=4dc8f7fd8dbdb33b117819fcda561b49>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    17 分钟 读完 (大约 2510 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/SqlLite数据库帮助类和基本DEMO/">SqlLite数据库帮助类和基本DEMO</a>
            
        </h1>
        <div class="content">
            <h2 id="SqlLite数据库帮助类和基本DEMO"><a href="#SqlLite数据库帮助类和基本DEMO" class="headerlink" title="SqlLite数据库帮助类和基本DEMO"></a>SqlLite数据库帮助类和基本DEMO</h2><h3 id="SQLlite优点"><a href="#SQLlite优点" class="headerlink" title="SQLlite优点"></a>SQLlite优点</h3><figure class="highlight lsl hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">◇轻量级</span><br><span class="line">SQLite和C/S模式的数据库软件不同，它是进程内的数据库引擎，因此不存在数据库的客户端和服务器。使用SQLite一般只需要带上它的一个动态 库，就可以享受它的全部功能。而且那个动态库的尺寸也挺小，以版本<span class="hljs-number">3.6</span><span class="hljs-number">.11</span>为例，Windows下<span class="hljs-number">487</span>KB、Linux下<span class="hljs-number">347</span>KB。</span><br><span class="line">◇绿色软件</span><br><span class="line">SQLite的另外一个特点是绿色：它的核心引擎本身不依赖第三方的软件，使用它也不需要“安装”。所以在部署的时候能够省去不少麻烦。</span><br><span class="line">◇单一文件</span><br><span class="line">所谓的“单一文件”，就是数据库中所有的信息（比如表、视图、触发器、等）都包含在一个文件内。这个文件可以copy到其它目录或其它机器上，也照用不误。</span><br><span class="line">◇跨平台/可移植性</span><br><span class="line">如果光支持主流操作系统，那就没啥好吹嘘的了。除了主流操作系统，SQLite还支持了很多冷门的操作系统。我个人比较感兴趣的是它对很多嵌入式系统（比如Android、WindowsMobile、Symbin、Palm、VxWorks等）的支持。</span><br><span class="line">◇内存数据库（in-memory database）</span><br><span class="line">这年头，内存越来越便宜，很多普通PC都开始以GB为单位来衡量内存（服务器就更甭提了）。这时候，SQLite的内存数据库特性就越发显得好用。</span><br><span class="line">SQLite的API不区分当前操作的数据库是在内存还是在文件（对于存储介质是透明的）。所以如果你觉得磁盘I/O有可能成为瓶颈的话，可以考虑切换 为内存方式。切换的时候，操作SQLite的代码基本不用大改，只要在开始时把文件Load到内存，结束时把内存的数据库Dump回文件就OK了。在这种情况下，前面提到的“onlinebackup API”就派上用场了，聪明的同学应该明白我为啥这么期待backup功能了吧？</span><br></pre></td></tr></table></figure>
<h3 id="添加引用"><a href="#添加引用" class="headerlink" title="添加引用"></a>添加引用</h3><h5 id="管理NuGet管理程序–-gt-浏览–-gt-搜索System-Data-SQLite-安装引用"><a href="#管理NuGet管理程序–-gt-浏览–-gt-搜索System-Data-SQLite-安装引用" class="headerlink" title="管理NuGet管理程序–&gt;浏览–&gt;搜索System.Data.SQLite,安装引用"></a>管理NuGet管理程序–&gt;浏览–&gt;搜索System.Data.SQLite,安装引用</h5><h5 id="或者直接在此下载-下载后引用System-Data-SQLite-dll，把SQLite-Interop-dll-zip解压放在debug目录下"><a href="#或者直接在此下载-下载后引用System-Data-SQLite-dll，把SQLite-Interop-dll-zip解压放在debug目录下" class="headerlink" title="或者直接在此下载,下载后引用System.Data.SQLite.dll，把SQLite.Interop.dll.zip解压放在debug目录下"></a>或者直接在此下载,下载后引用System.Data.SQLite.dll，把SQLite.Interop.dll.zip解压放在debug目录下</h5><p> 1.<a href="http://hemrj.cn/System.Data.SQLite.dll" target="_blank" rel="noopener">http://hemrj.cn/System.Data.SQLite.dll</a><br> 2.<a href="http://hemrj.cn/SQLite.Interop.dll.zip" target="_blank" rel="noopener">http://hemrj.cn/SQLite.Interop.dll.zip</a></p>
<h3 id="SqlLite帮助类"><a href="#SqlLite帮助类" class="headerlink" title="SqlLite帮助类"></a>SqlLite帮助类</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> System;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Data;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Data.Common;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Data.SQLite;</span><br><span class="line"><span class="hljs-keyword">using</span> System.IO;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Linq;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Text;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Threading.Tasks;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Nine.UnitlLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> SQLite数据库操作帮助类</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> 提供一系列方便的调用:</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> Execute,Save,Update,Delete...</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> @author Nine</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">SqlLiteHepler</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">bool</span> _showSql = <span class="hljs-literal">true</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 是否输出生成的SQL语句</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> ShowSql</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._showSql;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">this</span>._showSql = <span class="hljs-keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">readonly</span> <span class="hljs-keyword">string</span> _dataFile;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">private</span> SQLiteConnection _conn;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">SqlLiteHepler</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> dataFile</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (dataFile == <span class="hljs-literal">null</span>)</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"dataFile=null"</span>);</span><br><span class="line">            <span class="hljs-keyword">this</span>._dataFile = dataFile;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>打开SQLiteManager使用的数据库连接<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Open</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">this</span>._conn = OpenConnection(<span class="hljs-keyword">this</span>._dataFile);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Close</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._conn != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">this</span>._conn.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>安静地关闭连接,保存不抛出任何异常<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CloseQuietly</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._conn != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">try</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">this</span>._conn.Close();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">catch</span> &#123; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>创建一个连接到指定数据文件的SQLiteConnection,并Open<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>如果文件不存在,创建之<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="dataFile"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> SQLiteConnection <span class="hljs-title">OpenConnection</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> dataFile</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (dataFile == <span class="hljs-literal">null</span>)</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"dataFile=null"</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (!File.Exists(dataFile))</span><br><span class="line">            &#123;</span><br><span class="line">                SQLiteConnection.CreateFile(dataFile);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SQLiteConnection conn = <span class="hljs-keyword">new</span> SQLiteConnection();</span><br><span class="line">            SQLiteConnectionStringBuilder conStr = <span class="hljs-keyword">new</span> SQLiteConnectionStringBuilder</span><br><span class="line">            &#123;</span><br><span class="line">                DataSource = dataFile</span><br><span class="line">            &#125;;</span><br><span class="line">            conn.ConnectionString = conStr.ToString();</span><br><span class="line">            conn.Open();</span><br><span class="line">            <span class="hljs-keyword">return</span> conn;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>读取或设置SQLiteManager使用的数据库连接<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">public</span> SQLiteConnection Connection</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._conn;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">value</span> == <span class="hljs-literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">this</span>._conn = <span class="hljs-keyword">value</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">EnsureConnection</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>._conn == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(<span class="hljs-string">"SQLiteManager.Connection=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetDataFile</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._dataFile;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>判断表table是否存在<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="table"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">TableExists</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"table=null"</span>);</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line">            <span class="hljs-comment">// SELECT count(*) FROM sqlite_master WHERE type='table' AND name='test';</span></span><br><span class="line">            SQLiteCommand cmd = <span class="hljs-keyword">new</span> SQLiteCommand(<span class="hljs-string">"SELECT count(*) as c FROM sqlite_master WHERE type='table' AND name=@tableName "</span>);</span><br><span class="line">            cmd.Connection = <span class="hljs-keyword">this</span>.Connection;</span><br><span class="line">            cmd.Parameters.Add(<span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"tableName"</span>, table));</span><br><span class="line">            SQLiteDataReader reader = cmd.ExecuteReader();</span><br><span class="line">            reader.Read();</span><br><span class="line">            <span class="hljs-keyword">int</span> c = reader.GetInt32(<span class="hljs-number">0</span>);</span><br><span class="line">            reader.Close();</span><br><span class="line">            reader.Dispose();</span><br><span class="line">            cmd.Dispose();</span><br><span class="line">            <span class="hljs-comment">//return false;</span></span><br><span class="line">            <span class="hljs-keyword">return</span> c == <span class="hljs-number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行SQL,返回受影响的行数<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>可用于执行表创建语句<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>paramArr == null 表示无参数<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ExecuteNonQuery</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] paramArr</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (sql == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"sql=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ShowSql)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="hljs-string">"SQL: "</span> + sql);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SQLiteCommand cmd = <span class="hljs-keyword">new</span> SQLiteCommand();</span><br><span class="line">            cmd.CommandText = sql;</span><br><span class="line">            <span class="hljs-keyword">if</span> (paramArr != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">foreach</span> (SQLiteParameter p <span class="hljs-keyword">in</span> paramArr)</span><br><span class="line">                &#123;</span><br><span class="line">                    cmd.Parameters.Add(p);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            cmd.Connection = <span class="hljs-keyword">this</span>.Connection;</span><br><span class="line">            <span class="hljs-keyword">int</span> c = cmd.ExecuteNonQuery();</span><br><span class="line">            cmd.Dispose();</span><br><span class="line">            <span class="hljs-keyword">return</span> c;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行SQL,返回SQLiteDataReader<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>返回的Reader为原始状态,须自行调用Read()方法<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>paramArr=null,则表示无参数<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="paramArr"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> SQLiteDataReader <span class="hljs-title">ExecuteReader</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] paramArr</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">return</span> (SQLiteDataReader)ExecuteReader(sql, paramArr, (ReaderWrapper)<span class="hljs-literal">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行SQL,如果readerWrapper!=null,那么将调用readerWrapper对SQLiteDataReader进行包装,并返回结果<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="paramArr"&gt;</span>null 表示无参数<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="readerWrapper"&gt;</span>null 直接返回SQLiteDataReader<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">object</span> <span class="hljs-title">ExecuteReader</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] paramArr, ReaderWrapper readerWrapper</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (sql == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"sql=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line"></span><br><span class="line">            SQLiteCommand cmd = <span class="hljs-keyword">new</span> SQLiteCommand(sql, <span class="hljs-keyword">this</span>.Connection);</span><br><span class="line">            <span class="hljs-keyword">if</span> (paramArr != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">foreach</span> (SQLiteParameter p <span class="hljs-keyword">in</span> paramArr)</span><br><span class="line">                &#123;</span><br><span class="line">                    cmd.Parameters.Add(p);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            SQLiteDataReader reader = cmd.ExecuteReader();</span><br><span class="line">            <span class="hljs-keyword">object</span> result = <span class="hljs-literal">null</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (readerWrapper != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                result = readerWrapper(reader);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                result = reader;</span><br><span class="line">            &#125;</span><br><span class="line">            reader.Close();</span><br><span class="line">            reader.Dispose();</span><br><span class="line">            cmd.Dispose();</span><br><span class="line">            <span class="hljs-keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行SQL,返回结果集,使用RowWrapper对每一行进行包装<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>如果结果集为空,那么返回空List (List.Count=0)<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>rowWrapper = null时,使用WrapRowToDictionary<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="paramArr"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="rowWrapper"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;<span class="hljs-keyword">object</span>&gt; <span class="hljs-title">ExecuteRow</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] paramArr, RowWrapper rowWrapper</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (sql == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"sql=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line"></span><br><span class="line">            SQLiteCommand cmd = <span class="hljs-keyword">new</span> SQLiteCommand(sql, <span class="hljs-keyword">this</span>.Connection);</span><br><span class="line">            <span class="hljs-keyword">if</span> (paramArr != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">foreach</span> (SQLiteParameter p <span class="hljs-keyword">in</span> paramArr)</span><br><span class="line">                &#123;</span><br><span class="line">                    cmd.Parameters.Add(p);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (rowWrapper == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rowWrapper = <span class="hljs-keyword">new</span> RowWrapper(SqlLiteHepler.WrapRowToDictionary);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            SQLiteDataReader reader = cmd.ExecuteReader();</span><br><span class="line">            List&lt;<span class="hljs-keyword">object</span>&gt; result = <span class="hljs-keyword">new</span> List&lt;<span class="hljs-keyword">object</span>&gt;();</span><br><span class="line">            <span class="hljs-keyword">if</span> (reader.HasRows)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">int</span> rowNum = <span class="hljs-number">0</span>;</span><br><span class="line">                <span class="hljs-keyword">while</span> (reader.Read())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">object</span> row = rowWrapper(rowNum, reader);</span><br><span class="line">                    result.Add(row);</span><br><span class="line">                    rowNum++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            reader.Close();</span><br><span class="line">            reader.Dispose();</span><br><span class="line">            cmd.Dispose();</span><br><span class="line">            <span class="hljs-keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">object</span> <span class="hljs-title">WrapRowToDictionary</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> rowNum, SQLiteDataReader reader</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> fc = reader.FieldCount;</span><br><span class="line">            Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; row = <span class="hljs-keyword">new</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;();</span><br><span class="line">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fc; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">string</span> fieldName = reader.GetName(i);</span><br><span class="line">                <span class="hljs-keyword">object</span> <span class="hljs-keyword">value</span> = reader.GetValue(i);</span><br><span class="line">                row.Add(fieldName, <span class="hljs-keyword">value</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> row;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行insert into语句<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="table"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="entity"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Save</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; entity</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"table=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line">            <span class="hljs-keyword">string</span> sql = BuildInsert(table, entity);</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ExecuteNonQuery(sql, BuildParamArray(entity));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> SQLiteParameter[] <span class="hljs-title">BuildParamArray</span>(<span class="hljs-params">Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; entity</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            List&lt;SQLiteParameter&gt; list = <span class="hljs-keyword">new</span> List&lt;SQLiteParameter&gt;();</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> key <span class="hljs-keyword">in</span> entity.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                list.Add(<span class="hljs-keyword">new</span> SQLiteParameter(key, entity[key]));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (list.Count == <span class="hljs-number">0</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> list.ToArray();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">BuildInsert</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; entity</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder();</span><br><span class="line">            buf.Append(<span class="hljs-string">"insert into "</span>).Append(table);</span><br><span class="line">            buf.Append(<span class="hljs-string">" ("</span>);</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> key <span class="hljs-keyword">in</span> entity.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                buf.Append(key).Append(<span class="hljs-string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            buf.Remove(buf.Length - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>); <span class="hljs-comment">// 移除最后一个,</span></span><br><span class="line">            buf.Append(<span class="hljs-string">") "</span>);</span><br><span class="line">            buf.Append(<span class="hljs-string">"values("</span>);</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> key <span class="hljs-keyword">in</span> entity.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                buf.Append(<span class="hljs-string">"@"</span>).Append(key).Append(<span class="hljs-string">","</span>); <span class="hljs-comment">// 创建一个参数</span></span><br><span class="line">            &#125;</span><br><span class="line">            buf.Remove(buf.Length - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            buf.Append(<span class="hljs-string">") "</span>);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">return</span> buf.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">BuildUpdate</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; entity</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            StringBuilder buf = <span class="hljs-keyword">new</span> StringBuilder();</span><br><span class="line">            buf.Append(<span class="hljs-string">"update "</span>).Append(table).Append(<span class="hljs-string">" set "</span>);</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> key <span class="hljs-keyword">in</span> entity.Keys)</span><br><span class="line">            &#123;</span><br><span class="line">                buf.Append(key).Append(<span class="hljs-string">"="</span>).Append(<span class="hljs-string">"@"</span>).Append(key).Append(<span class="hljs-string">","</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            buf.Remove(buf.Length - <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            buf.Append(<span class="hljs-string">" "</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> buf.ToString();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>执行update语句<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>where参数不必要包含'where'关键字<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>如果where=null,那么忽略whereParams<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>如果where!=null,whereParams=null,where部分无参数<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="table"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="entity"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="where"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="whereParams"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Update</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; entity, <span class="hljs-keyword">string</span> <span class="hljs-keyword">where</span>, SQLiteParameter[] whereParams</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"table=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line">            <span class="hljs-keyword">string</span> sql = BuildUpdate(table, entity);</span><br><span class="line">            SQLiteParameter[] arr = BuildParamArray(entity);</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">where</span> != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sql += <span class="hljs-string">" where "</span> + <span class="hljs-keyword">where</span>;</span><br><span class="line">                <span class="hljs-keyword">if</span> (whereParams != <span class="hljs-literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    SQLiteParameter[] newArr = <span class="hljs-keyword">new</span> SQLiteParameter[arr.Length + whereParams.Length];</span><br><span class="line">                    Array.Copy(arr, newArr, arr.Length);</span><br><span class="line">                    Array.Copy(whereParams, <span class="hljs-number">0</span>, newArr, arr.Length, whereParams.Length);</span><br><span class="line"></span><br><span class="line">                    arr = newArr;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ExecuteNonQuery(sql, arr);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>查询一行记录,无结果时返回null<span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;para&gt;</span>conditionCol = null时将忽略条件,直接执行select * from table <span class="hljs-doctag">&lt;/para&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="table"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="conditionCol"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="conditionVal"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt; <span class="hljs-title">QueryOne</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, <span class="hljs-keyword">string</span> conditionCol, <span class="hljs-keyword">object</span> conditionVal</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"table=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">string</span> sql = <span class="hljs-string">"select * from "</span> + table;</span><br><span class="line">            <span class="hljs-keyword">if</span> (conditionCol != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sql += <span class="hljs-string">" where "</span> + conditionCol + <span class="hljs-string">"=@"</span> + conditionCol;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.ShowSql)</span><br><span class="line">            &#123;</span><br><span class="line">                Console.WriteLine(<span class="hljs-string">"SQL: "</span> + sql);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            List&lt;<span class="hljs-keyword">object</span>&gt; list = <span class="hljs-keyword">this</span>.ExecuteRow(sql, <span class="hljs-keyword">new</span> SQLiteParameter[] &#123;</span><br><span class="line">                <span class="hljs-keyword">new</span> SQLiteParameter(conditionCol,conditionVal)</span><br><span class="line">            &#125;, <span class="hljs-literal">null</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span> (list.Count == <span class="hljs-number">0</span>)</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">            <span class="hljs-keyword">return</span> (Dictionary&lt;<span class="hljs-keyword">string</span>, <span class="hljs-keyword">object</span>&gt;)list[<span class="hljs-number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 执行delete from table 语句</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> where不必包含'where'关键字</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> where=null时将忽略whereParams</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="table"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="where"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="whereParams"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">Delete</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> table, <span class="hljs-keyword">string</span> <span class="hljs-keyword">where</span>, SQLiteParameter[] whereParams</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (table == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ArgumentNullException(<span class="hljs-string">"table=null"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">this</span>.EnsureConnection();</span><br><span class="line">            <span class="hljs-keyword">string</span> sql = <span class="hljs-string">"delete from "</span> + table + <span class="hljs-string">" "</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">where</span> != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                sql += <span class="hljs-string">"where "</span> + <span class="hljs-keyword">where</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.ExecuteNonQuery(sql, whereParams);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> NINE 19.10.10</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 执行一个查询语句，返回一个包含查询结果的DataTable </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span>要执行的查询语句<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="parameters"&gt;</span>执行SQL查询语句所需要的参数，参数必须以它们在SQL语句中的顺序为准<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> DataTable <span class="hljs-title">ExecuteDataTable</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] parameters</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">using</span> (SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(sql, _conn))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    command.Parameters.AddRange(parameters);</span><br><span class="line">                &#125;</span><br><span class="line">                SQLiteDataAdapter adapter = <span class="hljs-keyword">new</span> SQLiteDataAdapter(command);</span><br><span class="line">                DataTable data = <span class="hljs-keyword">new</span> DataTable();</span><br><span class="line">                adapter.Fill(data);</span><br><span class="line">                <span class="hljs-keyword">return</span> data;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 创建SQLite数据库文件 </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="dbPath"&gt;</span>要创建的SQLite数据库文件路径<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CreateDB</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> dbPath</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">using</span> (SQLiteConnection connection = <span class="hljs-keyword">new</span> SQLiteConnection(<span class="hljs-string">"Data Source="</span> + dbPath))</span><br><span class="line">            &#123;</span><br><span class="line">                connection.Open();</span><br><span class="line">                <span class="hljs-keyword">using</span> (SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(connection))</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = <span class="hljs-string">"CREATE TABLE Demo(id integer NOT NULL PRIMARY KEY AUTOINCREMENT UNIQUE)"</span>;</span><br><span class="line">                    command.ExecuteNonQuery();</span><br><span class="line">                    command.CommandText = <span class="hljs-string">"DROP TABLE Demo"</span>;</span><br><span class="line">                    command.ExecuteNonQuery();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 对SQLite数据库执行增删改操作，返回受影响的行数。 </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span>要执行的增删改的SQL语句<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="parameters"&gt;</span>执行增删改语句所需要的参数，参数必须以它们在SQL语句中的顺序为准<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">ExecuteNonQuerySql</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] parameters</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> affectedRows = <span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-keyword">using</span> (DbTransaction transaction = _conn.BeginTransaction())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">using</span> (SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(_conn))</span><br><span class="line">                &#123;</span><br><span class="line">                    command.CommandText = sql;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        command.Parameters.AddRange(parameters);</span><br><span class="line">                    &#125;</span><br><span class="line">                    affectedRows = command.ExecuteNonQuery();</span><br><span class="line">                &#125;</span><br><span class="line">                transaction.Commit();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> affectedRows;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 执行一个查询语句，返回一个关联的SQLiteDataReader实例 </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span>要执行的查询语句<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="parameters"&gt;</span>执行SQL查询语句所需要的参数，参数必须以它们在SQL语句中的顺序为准<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> SQLiteDataReader <span class="hljs-title">ExecuteReaderSql</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] parameters</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(sql, _conn);</span><br><span class="line">            <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                command.Parameters.AddRange(parameters);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> command.ExecuteReader(CommandBehavior.CloseConnection);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 执行一个查询语句，返回查询结果的第一行第一列 </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sql"&gt;</span>要执行的查询语句<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="parameters"&gt;</span>执行SQL查询语句所需要的参数，参数必须以它们在SQL语句中的顺序为准<span class="hljs-doctag">&lt;/param&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> Object <span class="hljs-title">ExecuteScalar</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sql, SQLiteParameter[] parameters</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">using</span> (SQLiteCommand command = <span class="hljs-keyword">new</span> SQLiteCommand(sql, _conn))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    command.Parameters.AddRange(parameters);</span><br><span class="line">                &#125;</span><br><span class="line">                SQLiteDataAdapter adapter = <span class="hljs-keyword">new</span> SQLiteDataAdapter(command);</span><br><span class="line">                DataTable data = <span class="hljs-keyword">new</span> DataTable();</span><br><span class="line">                adapter.Fill(data);</span><br><span class="line">                <span class="hljs-keyword">return</span> data;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> 查询数据库中的所有数据类型信息 </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span> </span></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> DataTable <span class="hljs-title">GetSchema</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">using</span> (SQLiteConnection connection = <span class="hljs-keyword">new</span> SQLiteConnection(_conn))</span><br><span class="line">            &#123;</span><br><span class="line">                DataTable data = connection.GetSchema(<span class="hljs-string">"TABLES"</span>);</span><br><span class="line">                connection.Close();</span><br><span class="line">                <span class="hljs-comment">//foreach (DataColumn column in data.Columns) </span></span><br><span class="line">                <span class="hljs-comment">//&#123; </span></span><br><span class="line">                <span class="hljs-comment">//  Console.WriteLine(column.ColumnName); </span></span><br><span class="line">                <span class="hljs-comment">//&#125; </span></span><br><span class="line">                <span class="hljs-keyword">return</span> data;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> 在SQLiteManager.Execute方法中回调,将SQLiteDataReader包装成object </span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="reader"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">delegate</span> <span class="hljs-keyword">object</span> <span class="hljs-title">ReaderWrapper</span>(<span class="hljs-params">SQLiteDataReader reader</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> 将SQLiteDataReader的行包装成object</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="rowNum"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="reader"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">delegate</span> <span class="hljs-keyword">object</span> <span class="hljs-title">RowWrapper</span>(<span class="hljs-params"><span class="hljs-keyword">int</span> rowNum, SQLiteDataReader reader</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="SqlLite-DEMO"><a href="#SqlLite-DEMO" class="headerlink" title="SqlLite DEMO"></a>SqlLite DEMO</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> System;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Data.SQLite;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">SqlLiteHelper</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> MainWindow.xaml 的交互逻辑</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span> : <span class="hljs-title">Window</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainWindow</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Window_Loaded</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            SqlLiteHepler sqlLiteHepler = <span class="hljs-keyword">new</span> SqlLiteHepler(<span class="hljs-string">@"D:\NineBackstageToolsDB.db"</span>);</span><br><span class="line">            sqlLiteHepler.Open();</span><br><span class="line">            <span class="hljs-comment">//insert</span></span><br><span class="line">            <span class="hljs-keyword">string</span> insertSql = <span class="hljs-string">"INSERT INTO CountUserData(JsonData) values (@JsonData)"</span>;</span><br><span class="line">            SQLiteParameter[] insertParameters = <span class="hljs-keyword">new</span> SQLiteParameter[]&#123;</span><br><span class="line">            <span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"@JsonData"</span>,<span class="hljs-string">"test"</span>) &#125;;</span><br><span class="line">            <span class="hljs-keyword">int</span> insertRowCount = sqlLiteHepler.ExecuteNonQuerySql(insertSql, insertParameters);</span><br><span class="line">            <span class="hljs-comment">//update</span></span><br><span class="line">            <span class="hljs-keyword">string</span> updateSql = <span class="hljs-string">"Update CountUserData  set JsonData= @JsonData where id = @ID"</span>;</span><br><span class="line">            SQLiteParameter[] updateParameters = <span class="hljs-keyword">new</span> SQLiteParameter[]&#123;</span><br><span class="line">            <span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"@JsonData"</span>,<span class="hljs-string">"update"</span>),</span><br><span class="line">            <span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"@ID"</span>,<span class="hljs-string">"3"</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="hljs-keyword">int</span> updateRowCount = sqlLiteHepler.ExecuteNonQuerySql(updateSql, updateParameters);</span><br><span class="line">            <span class="hljs-comment">//delete</span></span><br><span class="line">            <span class="hljs-keyword">string</span> deleteSql = <span class="hljs-string">"delete from CountUserData where id = @ID"</span>;</span><br><span class="line">            SQLiteParameter[] deleteParameters = <span class="hljs-keyword">new</span> SQLiteParameter[]&#123;</span><br><span class="line">            <span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"@ID"</span>,<span class="hljs-string">"4"</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">            <span class="hljs-keyword">int</span> deleteRowCount = sqlLiteHepler.ExecuteNonQuerySql(deleteSql, deleteParameters);</span><br><span class="line">            <span class="hljs-comment">//select</span></span><br><span class="line">            <span class="hljs-keyword">string</span> sqlText = <span class="hljs-string">"select * from XyhisLog where (logtime) &gt; (@logtime)"</span>;</span><br><span class="line">            SQLiteParameter[] selectParameters = <span class="hljs-keyword">new</span> SQLiteParameter[]&#123;</span><br><span class="line">            <span class="hljs-keyword">new</span> SQLiteParameter(<span class="hljs-string">"@logtime"</span>,DateTime.Now.Date.ToString().Replace(<span class="hljs-string">"/"</span>,<span class="hljs-string">"-"</span>)) &#125;;</span><br><span class="line">            <span class="hljs-keyword">var</span> ss = sqlLiteHepler.ExecuteDataTable(sqlText, selectParameters);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SqlLiteHelper Demo 源码下载 <a href="http://hemrj.cn/SqlLiteHelper.zip" target="_blank" rel="noopener">http://hemrj.cn/SqlLiteHelper.zip</a></p>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T06:25:43.000Z">2019-10-16</time>
                
                    <span class="display-none-class">04fc4f4615047a55be56e2db10838d9c</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=04fc4f4615047a55be56e2db10838d9c>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    10 分钟 读完 (大约 1563 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/WPF属性双向绑定/">WPF属性双向绑定</a>
            
        </h1>
        <div class="content">
            <p>WPF最主要的特性之一，双向绑定</p>
<h2 id="基本原理"><a href="#基本原理" class="headerlink" title="基本原理"></a>基本原理</h2><figure class="highlight q hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">DependencyObject中拥有一个字典保存绑定信息，字典的<span class="hljs-built_in">key</span>是依赖属性，<span class="hljs-built_in">value</span>为绑定的值。对于绑定SetBinding方法是关键，他处理保存bingding对象的键值对，如果bingding对象中保存的TargetObject（被绑定对象）实现INotifyPropertyChanged接口，那么监听TargetObject的PropertyChanged事件，TargetObject一旦改变就修改依赖属性的值，这就可以实现了通知。而对于双向绑定，奥秘就在给依赖属性赋值的SetValue(xx,xx)方法中,这个方法中会查找管理绑定的那个字典，当前依赖属性是否绑定了值，如果绑定了并且是双向绑定，就给TargetObject设置新值，实现双向绑定。</span><br><span class="line"></span><br><span class="line">基础理论这种东西，看着有点犯困，基本了解就行，双向绑定主要是解耦合，数据实时刷新</span><br><span class="line"></span><br><span class="line">WPF双向数据同步：目标属性（UI）和源属性（CS）数据同步。</span><br><span class="line">实现双向数据同步数据源需要实现依赖属性INotifyPropertyChanged接口，因为依赖属性有垂直的内嵌变更通知机制。</span><br><span class="line">INotifyPropertyChanged是用于实现界面通知。</span><br><span class="line">DependencyObject是实现依赖对象的依赖属性。</span><br></pre></td></tr></table></figure>
<h2 id="实践"><a href="#实践" class="headerlink" title="实践"></a>实践</h2><h3 id="Xaml"><a href="#Xaml" class="headerlink" title="Xaml"></a>Xaml</h3><figure class="highlight dust hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;<span class="hljs-name">Window</span> <span class="hljs-attr">x:Class</span>=<span class="hljs-string">"WPFDemo.Window1"</span></span></span></span><br><span class="line"><span class="hljs-xml">        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"</span></span><br><span class="line"><span class="hljs-xml">        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"</span></span><br><span class="line"><span class="hljs-xml">        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"</span></span><br><span class="line"><span class="hljs-xml">        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"</span></span><br><span class="line"><span class="hljs-xml">        xmlns:local="clr-namespace:WPFDemo"</span></span><br><span class="line"><span class="hljs-xml">        mc:Ignorable="d"</span></span><br><span class="line"><span class="hljs-xml">        Title="Window1" Height="300" Width="300"&gt;</span></span><br><span class="line"><span class="hljs-xml">    </span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;<span class="hljs-name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">Button</span> <span class="hljs-attr">Name</span>=<span class="hljs-string">"Button_OK"</span> <span class="hljs-attr">MaxWidth</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">MaxHeight</span>=<span class="hljs-string">"20"</span> <span class="hljs-attr">Click</span>=<span class="hljs-string">"Button_OK_Click"</span>&gt;</span>OK<span class="hljs-tag">&lt;/<span class="hljs-name">Button</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">        <span class="hljs-tag">&lt;<span class="hljs-name">TextBlock</span> <span class="hljs-attr">MaxWidth</span>=<span class="hljs-string">"50"</span> <span class="hljs-attr">MaxHeight</span>=<span class="hljs-string">"20"</span> <span class="hljs-attr">VerticalAlignment</span>=<span class="hljs-string">"Top"</span>  <span class="hljs-attr">HorizontalAlignment</span>=<span class="hljs-string">"Left"</span> <span class="hljs-attr">Text</span>=<span class="hljs-string">"</span></span></span><span class="hljs-template-variable">&#123;Binding Text&#125;</span><span class="hljs-xml"><span class="hljs-tag"><span class="hljs-string">"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">TextBlock</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml">    <span class="hljs-tag">&lt;/<span class="hljs-name">Grid</span>&gt;</span></span></span><br><span class="line"><span class="hljs-xml"><span class="hljs-tag">&lt;/<span class="hljs-name">Window</span>&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="ViewModel"><a href="#ViewModel" class="headerlink" title="ViewModel"></a>ViewModel</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">ObservableObject实现了INotifyPropertyChanged，项目中，一般我们把这个抽取重构为一个viewmodel的基类，继承ViewModelBase即可实现INotifyPropertyChanged</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainViewModel</span> : <span class="hljs-title">ViewModelBase</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainViewModel</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            Init();</span><br><span class="line">            InitCommand();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-comment">//双向绑定属性</span></span><br><span class="line">        <span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> _text;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> Text</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">get</span> &#123; <span class="hljs-keyword">return</span> _text; &#125;</span><br><span class="line">            <span class="hljs-keyword">set</span> &#123; <span class="hljs-keyword">this</span>.SetProperty(<span class="hljs-keyword">ref</span> _text, <span class="hljs-keyword">value</span>); &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="DependencyObject"><a href="#DependencyObject" class="headerlink" title="DependencyObject"></a>DependencyObject</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> System.ComponentModel;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Runtime.CompilerServices;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Nine.UnitlLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ObservableObject</span> : <span class="hljs-title">INotifyPropertyChanged</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> 属性更改机制</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> PropertyChangedEventHandler PropertyChanged;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> 支持.NET4.5/.NET4.0</span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;typeparam name="T"&gt;</span>属性类型<span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="storage"&gt;</span>被设置的属性<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="isCheckEquals"&gt;</span>是否检查属性相等<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="value"&gt;</span>将要设置的属性值<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> SetProperty&lt;T&gt;(<span class="hljs-keyword">ref</span> T storage, T <span class="hljs-keyword">value</span>, <span class="hljs-keyword">bool</span> isCheckEquals = <span class="hljs-literal">true</span>, [CallerMemberName] <span class="hljs-keyword">string</span> propertyName = <span class="hljs-literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (isCheckEquals)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">object</span>.Equals(storage, <span class="hljs-keyword">value</span>)) &#123; <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            storage = <span class="hljs-keyword">value</span>;</span><br><span class="line">            OnPropertyChanged(propertyName);</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;typeparam name="T"&gt;</span>属性类型<span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="storage"&gt;</span>被设置的属性<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="isCheckEquals"&gt;</span>是否检查属性相等<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="value"&gt;</span>将要设置的属性值<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-keyword">protected</span> <span class="hljs-keyword">bool</span> SetProperty&lt;T&gt;(<span class="hljs-keyword">ref</span> T storage, T <span class="hljs-keyword">value</span>, [CallerMemberName] <span class="hljs-keyword">string</span> propertyName = <span class="hljs-literal">null</span>, <span class="hljs-keyword">params</span> <span class="hljs-keyword">string</span>[] propertyNames)</span><br><span class="line">        &#123;</span><br><span class="line">            storage = <span class="hljs-keyword">value</span>;</span><br><span class="line">            OnPropertyChanged(propertyName);</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> propertyname <span class="hljs-keyword">in</span> propertyNames)</span><br><span class="line">            &#123;</span><br><span class="line">                OnPropertyChanged(propertyname);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">OnPropertyChanged</span>(<span class="hljs-params">[CallerMemberName] <span class="hljs-keyword">string</span> propertyName = <span class="hljs-literal">null</span></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            PropertyChangedEventHandler eventHandler = PropertyChanged;</span><br><span class="line">            <span class="hljs-keyword">if</span> (eventHandler != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                eventHandler(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> PropertyChangedEventArgs(propertyName));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> 支持.NET4.0</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//private static string GetProperyName(string methodName)</span></span><br><span class="line">        <span class="hljs-comment">//&#123;</span></span><br><span class="line">        <span class="hljs-comment">//    if (methodName.StartsWith("get_") || methodName.StartsWith("set_") ||</span></span><br><span class="line">        <span class="hljs-comment">//        methodName.StartsWith("put_"))</span></span><br><span class="line">        <span class="hljs-comment">//    &#123;</span></span><br><span class="line">        <span class="hljs-comment">//        return methodName.Substring("get_".Length);</span></span><br><span class="line">        <span class="hljs-comment">//    &#125;</span></span><br><span class="line">        <span class="hljs-comment">//    throw new Exception(methodName + " not a method of Property");</span></span><br><span class="line">        <span class="hljs-comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//protected bool SetProperty&lt;T&gt;(ref T storage, T value)</span></span><br><span class="line">        <span class="hljs-comment">//&#123;</span></span><br><span class="line">        <span class="hljs-comment">//    if (object.Equals(storage, value)) &#123; return false; &#125;</span></span><br><span class="line">        <span class="hljs-comment">//    storage = value;</span></span><br><span class="line">        <span class="hljs-comment">//    string propertyName = GetProperyName(new System.Diagnostics.StackTrace(true).GetFrame(1).GetMethod().Name);</span></span><br><span class="line">        <span class="hljs-comment">//    this.OnPropertyChanged(propertyName);</span></span><br><span class="line">        <span class="hljs-comment">//    return true;</span></span><br><span class="line">        <span class="hljs-comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// </span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;typeparam name="T"&gt;</span>属性类型<span class="hljs-doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;param name="storage"&gt;</span>被设置的属性<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;param name="value"&gt;</span>将要设置的属性值<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;param name="isCheckEquals"&gt;</span>是否检查属性相等<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line">        <span class="hljs-comment"><span class="hljs-doctag">///</span>// <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line">        <span class="hljs-comment">//protected bool SetProperty&lt;T&gt;(ref T storage, T value, bool isCheckEquals)</span></span><br><span class="line">        <span class="hljs-comment">//&#123;</span></span><br><span class="line">        <span class="hljs-comment">//    if (isCheckEquals)</span></span><br><span class="line">        <span class="hljs-comment">//        if (object.Equals(storage, value)) &#123; return false; &#125;</span></span><br><span class="line">        <span class="hljs-comment">//    storage = value;</span></span><br><span class="line">        <span class="hljs-comment">//    string propertyName = GetProperyName(new System.Diagnostics.StackTrace(true).GetFrame(1).GetMethod().Name);</span></span><br><span class="line">        <span class="hljs-comment">//    this.OnPropertyChanged(propertyName);</span></span><br><span class="line">        <span class="hljs-comment">//    return true;</span></span><br><span class="line">        <span class="hljs-comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//private void OnPropertyChanged(string propertyName)</span></span><br><span class="line">        <span class="hljs-comment">//&#123;</span></span><br><span class="line">        <span class="hljs-comment">//    var eventHandler = this.PropertyChanged;</span></span><br><span class="line">        <span class="hljs-comment">//    if (eventHandler != null)</span></span><br><span class="line">        <span class="hljs-comment">//    &#123;</span></span><br><span class="line">        <span class="hljs-comment">//        eventHandler(this, new PropertyChangedEventArgs(propertyName));</span></span><br><span class="line">        <span class="hljs-comment">//    &#125;</span></span><br><span class="line">        <span class="hljs-comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">        <span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ViewModelBase"><a href="#ViewModelBase" class="headerlink" title="ViewModelBase"></a>ViewModelBase</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">ViewModelBase</span> : <span class="hljs-title">ObservableObject</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> PropertyChangedEventHandler PropertyChanged;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">RaisePropertyChanged</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> propertyName</span>)</span></span><br><span class="line"><span class="hljs-function"></span>    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (PropertyChanged != <span class="hljs-literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            PropertyChanged.Invoke(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">new</span> PropertyChangedEventArgs(propertyName));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="ObservableCollection"><a href="#ObservableCollection" class="headerlink" title="ObservableCollection"></a>ObservableCollection<t></t></h3><h4 id="WPF-提供-ObservableCollection-类，它是实现-INotifyCollectionChanged-接口的数据集合的内置实现。"><a href="#WPF-提供-ObservableCollection-类，它是实现-INotifyCollectionChanged-接口的数据集合的内置实现。" class="headerlink" title="WPF 提供 ObservableCollection 类，它是实现 INotifyCollectionChanged 接口的数据集合的内置实现。"></a>WPF 提供 ObservableCollection<t> 类，它是实现 INotifyCollectionChanged 接口的数据集合的内置实现。</t></h4><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class<span class="hljs-built_in"> Users </span>: ObservableCollection&lt;Users&gt;</span><br><span class="line">&#123;</span><br><span class="line">    public Users() : base()</span><br><span class="line">    &#123;</span><br><span class="line">            </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Binding对象的属性说明"><a href="#Binding对象的属性说明" class="headerlink" title="Binding对象的属性说明"></a>Binding对象的属性说明</h3><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">属性名                 描述         </span><br><span class="line">1、Converter：转换器,将绑定的内容转换成自己需要的内容。自定义转换类 必须继承于:IValueConverter接口</span><br><span class="line">2、ElementName：绑定的源对象,本人理解 专程用于UI控件之间属性的绑定</span><br><span class="line">3、FallbackValue ：绑定无法返回有效值时的默认显示值</span><br><span class="line">4、Mode：绑定方式，枚举类型<span class="hljs-built_in"> Default </span>OneWay TwoWay OneTime OneWayToSource</span><br><span class="line">5、Path：属性 路径，用来指定要绑定数据源的路径，其性质是一个属性，该属性该当是依靠属性，也即便能够告终积极更新机制的【单个类实现INotifyPropertyChanged、集合要 实现INotifyCollectionChanged接口】</span><br><span class="line">6、RelativeSource：常用于自身绑定或者数据模板中来指定绑定的源对象及控件模块中的绑定。</span><br><span class="line">7、Source：源对象，控件或自定义对象等。</span><br><span class="line">8、StringFormat：格式化表达式</span><br><span class="line">9、UpdateSourceTrigger：在双向绑定时TwoWay 或 OneWayToSource 时。用来确定属性更改的时机。UpdateSourceTrigger枚举类型：Default,PropertyChanged,LostFocus,Explicit。</span><br><span class="line">10、ValidationRules：验证规则.可以被设置为一个或多个派生自ValidationRule的对象，每个规则都会检查特定的条件并更具结果来标记数据的有效性</span><br></pre></td></tr></table></figure>
<h3 id="Mode指定绑定的方向"><a href="#Mode指定绑定的方向" class="headerlink" title="Mode指定绑定的方向"></a>Mode指定绑定的方向</h3><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">数据绑定模式共有四种：OneTime、OneWay、OneWayToSource和TwoWay，默认是TwoWay。</span><br><span class="line"></span><br><span class="line">TwoWay 当发生更改时的目标属性或源属性更新目标属性。</span><br><span class="line">OneWay 仅当源属性更改时，请更新目标属性。</span><br><span class="line">OneTime 仅当应用程序启动时或时，请更新目标属性DataContext发生了更改。</span><br><span class="line">OneWayToSource 目标属性更改时，请更新源属性。</span><br><span class="line">Default 默认值将导致Mode要使用的目标属性的值。</span><br></pre></td></tr></table></figure>
<h3 id="UpdateSourceTrigger"><a href="#UpdateSourceTrigger" class="headerlink" title="UpdateSourceTrigger"></a>UpdateSourceTrigger</h3><figure class="highlight routeros hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">四种用来确定属性更改的时机，对于 <span class="hljs-attribute">Model</span>=TwoWay 及 OneWayToSource是源数据改变时机</span><br></pre></td></tr></table></figure>
<h3 id="UI属性绑定数据对象"><a href="#UI属性绑定数据对象" class="headerlink" title="UI属性绑定数据对象"></a>UI属性绑定数据对象</h3><figure class="highlight protobuf hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">UI属性直接绑定实例对象 。实例：Text=<span class="hljs-string">"&#123;Binding Path=EntryDate,StringFormat=yyyy-MM-dd&#125;"</span></span><br><span class="line"></span><br><span class="line">UI属性直接绑定静态对象。实例：DataContext=<span class="hljs-string">"&#123;x:Static local:GlobalData.user&#125;"</span></span><br><span class="line"></span><br><span class="line">UI属性绑定资源中的对象。DataContext=<span class="hljs-string">"&#123;StaticResource ResourceKey=userKey&#125;"</span></span><br></pre></td></tr></table></figure>
<h3 id="清除绑定"><a href="#清除绑定" class="headerlink" title="清除绑定"></a>清除绑定</h3><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">BindingOperations</span><span class="hljs-selector-class">.ClearBinding</span>(<span class="hljs-selector-tag">txtBlock</span>, <span class="hljs-selector-tag">TextBlock</span><span class="hljs-selector-class">.TextProperty</span>);</span><br></pre></td></tr></table></figure>
<h3 id="XAML绑定数据（方式一）"><a href="#XAML绑定数据（方式一）" class="headerlink" title="XAML绑定数据（方式一）"></a>XAML绑定数据（方式一）</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">这种情况只要 user实现了双向绑定则能自动绑定</span><br><span class="line">&lt;TextBox Name=<span class="hljs-string">"txtName"</span> Text=<span class="hljs-string">"&#123;Binding user.Name&#125;"</span>&gt;&lt;/TextBox&gt;</span><br><span class="line">&lt;TextBox Name=<span class="hljs-string">"txtEmail"</span> Text=<span class="hljs-string">"&#123;Binding user.Email&#125;"</span>&gt;&lt;/TextBox&gt;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">using</span> System;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">WPFBinding</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> MainWindow.xaml</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainWindow</span> : <span class="hljs-title">Window</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">public</span> ViewModel viewModel;</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainWindow</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            <span class="hljs-keyword">this</span>.viewModel = <span class="hljs-keyword">new</span> ViewModel();</span><br><span class="line">            <span class="hljs-keyword">this</span>.Loaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">this</span>.DataContext = viewModel;</span><br><span class="line">                <span class="hljs-keyword">this</span>.viewModel.user = <span class="hljs-keyword">new</span> Users()</span><br><span class="line">                &#123;</span><br><span class="line">                    Name = <span class="hljs-string">"Nine"</span>,</span><br><span class="line">                    Email = <span class="hljs-string">"343710716@qq.com"</span></span><br><span class="line">                &#125;;</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="交互逻辑，实例化数据（方式二）"><a href="#交互逻辑，实例化数据（方式二）" class="headerlink" title="交互逻辑，实例化数据（方式二）"></a>交互逻辑，实例化数据（方式二）</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;Label Name=<span class="hljs-string">"lblName"</span>&gt;&lt;/Label&gt;</span><br><span class="line">&lt;TextBox Name=<span class="hljs-string">"txtName"</span>&gt;&lt;/TextBox&gt;</span><br><span class="line">&lt;Label Name=<span class="hljs-string">"lblEmail"</span>&gt;&lt;/Label&gt;</span><br><span class="line">&lt;TextBox Name=<span class="hljs-string">"txtEmail"</span>&gt;&lt;/TextBox&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows.Controls;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows.Data;</span><br><span class="line"> </span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">WPFBinding</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> GetBinding.xaml</span></span><br><span class="line">    <span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">partial</span> <span class="hljs-keyword">class</span> <span class="hljs-title">GetBinding</span> : <span class="hljs-title">Window</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">public</span> ViewModel viewModel;</span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">GetBinding</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            InitializeComponent();</span><br><span class="line">            <span class="hljs-keyword">this</span>.viewModel = <span class="hljs-keyword">new</span> ViewModel();</span><br><span class="line">            <span class="hljs-keyword">this</span>.Loaded += (s, e) =&gt;</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">this</span>.DataContext = viewModel;</span><br><span class="line">                <span class="hljs-keyword">this</span>.viewModel.user = <span class="hljs-keyword">new</span> Users()</span><br><span class="line">                &#123;</span><br><span class="line">                    Name = <span class="hljs-string">"Nine"</span>,</span><br><span class="line">                    Email = <span class="hljs-string">"343710716@qq.com"</span></span><br><span class="line">                &#125;;</span><br><span class="line">                <span class="hljs-comment">//绑定依赖属性Name</span></span><br><span class="line">                txtName.SetBinding(TextBox.TextProperty, <span class="hljs-keyword">new</span> Binding(<span class="hljs-string">"Name"</span>) &#123; Source = viewModel.user &#125;);</span><br><span class="line">                <span class="hljs-comment">//绑定元素属性Text</span></span><br><span class="line">                lblName.SetBinding(ContentProperty, <span class="hljs-keyword">new</span> Binding(<span class="hljs-string">"Text"</span>) &#123; Source = txtName &#125;);</span><br><span class="line">                <span class="hljs-comment">//绑定依赖属性Email</span></span><br><span class="line">                txtEmail.SetBinding(TextBox.TextProperty, <span class="hljs-keyword">new</span> Binding(<span class="hljs-string">"Email"</span>) &#123; Source = viewModel.user &#125;);</span><br><span class="line">                <span class="hljs-comment">//绑定元素属性Text</span></span><br><span class="line">                lblEmail.SetBinding(ContentProperty, <span class="hljs-keyword">new</span> Binding(<span class="hljs-string">"Text"</span>) &#123; Source = txtEmail &#125;);</span><br><span class="line">            &#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T06:11:52.000Z">2019-10-16</time>
                
                    <span class="display-none-class">0dfd182d7a49549f7809123a06e9c330</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=0dfd182d7a49549f7809123a06e9c330>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    2 分钟 读完 (大约 364 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/WPF基本MVVM模式Command基类实现/">WPF基本MVVM模式Command基类实现</a>
            
        </h1>
        <div class="content">
            <h2 id="MVVM模式和MVC模式一样，主要目的是分离视图（View）和模型（Model），有几大优点"><a href="#MVVM模式和MVC模式一样，主要目的是分离视图（View）和模型（Model），有几大优点" class="headerlink" title="MVVM模式和MVC模式一样，主要目的是分离视图（View）和模型（Model），有几大优点"></a>MVVM模式和MVC模式一样，主要目的是分离视图（View）和模型（Model），有几大优点</h2><ol>
<li>低耦合。视图（View）可以独立于Model变化和修改，一个ViewModel可以绑定到不同的”View”上，当View变化的时候Model可以不变，当Model变化的时候View也可以不变。</li>
<li>可重用性。你可以把一些视图逻辑放在一个ViewModel里面，让很多view重用这段视图逻辑。</li>
<li>独立开发。开发人员可以专注于业务逻辑和数据的开发（ViewModel），设计人员可以专注于页面设计，使用Expression Blend可以很容易设计界面并生成xaml代码。</li>
<li>可测试。界面素来是比较难于测试的，而现在测试可以针对ViewModel来写。 </li>
</ol>
<h2 id="本文主要介绍实现基本的WPF-MVVM的命令实现"><a href="#本文主要介绍实现基本的WPF-MVVM的命令实现" class="headerlink" title="本文主要介绍实现基本的WPF MVVM的命令实现"></a>本文主要介绍实现基本的WPF MVVM的命令实现</h2><h3 id="Viewmodel"><a href="#Viewmodel" class="headerlink" title="Viewmodel"></a>Viewmodel</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">MainViewModel</span> : <span class="hljs-title">DelegateCommand</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">MainViewModel</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>    &#123;</span><br><span class="line">        Init();</span><br><span class="line">        InitCommand();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//声明命令</span></span><br><span class="line">    <span class="hljs-keyword">public</span> ICommand ReleaseCommand &#123; <span class="hljs-keyword">get</span>; <span class="hljs-keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">InitCommand</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>    &#123;</span><br><span class="line">        <span class="hljs-comment">//绑定命令，初始化</span></span><br><span class="line">        <span class="hljs-keyword">this</span>.ReleaseCommand = <span class="hljs-keyword">new</span> DelegateCommand((obj) =&gt; &#123; <span class="hljs-keyword">this</span>.ReleaseExecute(obj); &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-comment">//命令实现</span></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ReleaseExecute</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> obj</span>)</span></span><br><span class="line"><span class="hljs-function"></span>    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="命令双向绑定基类"><a href="#命令双向绑定基类" class="headerlink" title="命令双向绑定基类"></a>命令双向绑定基类</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-keyword">using</span> System;</span><br><span class="line"><span class="hljs-keyword">using</span> System.Windows.Input;</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">namespace</span> <span class="hljs-title">Nine.UnitlLibrary</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title">DelegateCommand</span> : <span class="hljs-title">ICommand</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">private</span> Action&lt;<span class="hljs-keyword">object</span>&gt; executeAction;</span><br><span class="line">        <span class="hljs-keyword">private</span> Func&lt;<span class="hljs-keyword">object</span>, <span class="hljs-keyword">bool</span>&gt; canExecuteFunc;</span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-keyword">event</span> EventHandler CanExecuteChanged;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DelegateCommand</span>(<span class="hljs-params">Action&lt;<span class="hljs-keyword">object</span>&gt; execute</span>)</span></span><br><span class="line"><span class="hljs-function">            : <span class="hljs-title">this</span>(<span class="hljs-params">execute, <span class="hljs-literal">null</span></span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123; &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">DelegateCommand</span>(<span class="hljs-params">Action&lt;<span class="hljs-keyword">object</span>&gt; execute, Func&lt;<span class="hljs-keyword">object</span>, <span class="hljs-keyword">bool</span>&gt; canExecute</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (execute == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            executeAction = execute;</span><br><span class="line">            canExecuteFunc = canExecute;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">bool</span> <span class="hljs-title">CanExecute</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> parameter</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (canExecuteFunc == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">return</span> canExecuteFunc(parameter);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Execute</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> parameter</span>)</span></span><br><span class="line"><span class="hljs-function"></span>        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (executeAction == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            executeAction(parameter);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T03:37:28.000Z">2019-10-16</time>
                
                    <span class="display-none-class">4be7975990d92dd19236f28fc911813a</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=4be7975990d92dd19236f28fc911813a>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    14 分钟 读完 (大约 2118 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/实用小工具代码代码块/">实用小工具代码代码块</a>
            
        </h1>
        <div class="content">
            <h1 id="net-开发常用代码收集模板，常用的一些复制，压缩，获取IIS信息等，工具常用收集"><a href="#net-开发常用代码收集模板，常用的一些复制，压缩，获取IIS信息等，工具常用收集" class="headerlink" title=".net 开发常用代码收集模板，常用的一些复制，压缩，获取IIS信息等，工具常用收集"></a>.net 开发常用代码收集模板，常用的一些复制，压缩，获取IIS信息等，工具常用收集</h1><h2 id="获取程序配置文件信息"><a href="#获取程序配置文件信息" class="headerlink" title="获取程序配置文件信息"></a>获取程序配置文件信息</h2><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">// 获取配置文件信息</span></span><br><span class="line"><span class="hljs-built_in">string</span> COMPERSSPATH = ConfigurationManager.AppSettings[<span class="hljs-string">"CompressPath"</span>].ToString();</span><br></pre></td></tr></table></figure>
<h2 id="获取网站配置文件信息Web-config"><a href="#获取网站配置文件信息Web-config" class="headerlink" title="获取网站配置文件信息Web.config"></a>获取网站配置文件信息Web.config</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 获取网站配置文件信息Web.config</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="SiteInfo"&gt;</span>站点信息IP+端口10.35.1.90:8096<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="SiteInfo"&gt;</span>参数名称<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>参数值<span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetSiteWebconfigInfo</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> SiteInfo, <span class="hljs-keyword">string</span> SettingName, <span class="hljs-keyword">string</span> fileNmae</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">string</span> strRreturn = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-keyword">string</span> sitePath = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-keyword">string</span>[] str = <span class="hljs-keyword">new</span> <span class="hljs-keyword">string</span>[<span class="hljs-number">2</span>];</span><br><span class="line">    str = SiteInfo.Split(<span class="hljs-string">':'</span>);</span><br><span class="line">    <span class="hljs-keyword">string</span> path = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-keyword">string</span> path2 = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-keyword">string</span> path3 = <span class="hljs-string">""</span>;</span><br><span class="line">    webManager = <span class="hljs-keyword">new</span> Microsoft.Web.Administration.ServerManager();</span><br><span class="line">    <span class="hljs-keyword">foreach</span> (Site site <span class="hljs-keyword">in</span> webManager.Sites)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">var</span> tmp <span class="hljs-keyword">in</span> site.Bindings)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (tmp.EndPoint != <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (tmp.EndPoint.Address != <span class="hljs-literal">null</span> || tmp.Host != <span class="hljs-string">""</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">if</span> (str[<span class="hljs-number">1</span>] == tmp.EndPoint.Port.ToString())</span><br><span class="line">                    &#123;</span><br><span class="line">                        GetSiteWebconfigInfoEx(SettingName, fileNmae, <span class="hljs-keyword">out</span> strRreturn, <span class="hljs-keyword">out</span> sitePath, <span class="hljs-keyword">out</span> path, <span class="hljs-keyword">out</span> path2, <span class="hljs-keyword">out</span> path3, site);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> strRreturn + <span class="hljs-string">"$"</span> + path2 + <span class="hljs-string">"$"</span> + path3;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">GetSiteWebconfigInfoEx</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> SettingName, <span class="hljs-keyword">string</span> fileNmae, <span class="hljs-keyword">out</span> <span class="hljs-keyword">string</span> strRreturn, <span class="hljs-keyword">out</span> <span class="hljs-keyword">string</span> sitePath, <span class="hljs-keyword">out</span> <span class="hljs-keyword">string</span> path, <span class="hljs-keyword">out</span> <span class="hljs-keyword">string</span> path2, <span class="hljs-keyword">out</span> <span class="hljs-keyword">string</span> path3, Site site</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    sitePath = site.Applications[<span class="hljs-string">"/"</span>].VirtualDirectories[<span class="hljs-string">"/"</span>].PhysicalPath;</span><br><span class="line">    <span class="hljs-keyword">string</span> His2Config = sitePath + <span class="hljs-string">@"\Web.config"</span>;</span><br><span class="line">    System.Configuration.Configuration _Configuration = <span class="hljs-literal">null</span>;</span><br><span class="line">    _Configuration = System.Configuration.ConfigurationManager.OpenMappedExeConfiguration(<span class="hljs-keyword">new</span> ExeConfigurationFileMap() &#123; ExeConfigFilename = His2Config &#125;, ConfigurationUserLevel.None);</span><br><span class="line">    path3 = sitePath + <span class="hljs-string">@"\update"</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        strRreturn = _Configuration.AppSettings.Settings[SettingName].Value;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception)</span><br><span class="line">    &#123;</span><br><span class="line">        strRreturn = <span class="hljs-string">"读取配置文件【"</span> + SettingName + <span class="hljs-string">"】失败"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    path = sitePath + <span class="hljs-string">@"\bin"</span>;</span><br><span class="line">    Directory.CreateDirectory(COMPERSSPATH + <span class="hljs-string">@"\HisRelease"</span>);</span><br><span class="line">    path2 = COMPERSSPATH + <span class="hljs-string">@"\HisRelease\"</span> + fileNmae + <span class="hljs-string">@".zip"</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (unZipFloClass.ZipCompressedFile(path, path2).Contains(<span class="hljs-string">"成功"</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">string</span> path4 = COMPERSSPATH + <span class="hljs-string">@"\HisRelease"</span>;</span><br><span class="line">            <span class="hljs-keyword">if</span> (Nine.UnitlLibrary.Unitl.CopyDirectory(path3, path4, <span class="hljs-literal">true</span>) == <span class="hljs-string">"成功"</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                path3 = path4 + <span class="hljs-string">@"\Server.xml"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            strRreturn += <span class="hljs-string">"文件压缩失败"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception)</span><br><span class="line">    &#123;</span><br><span class="line">        strRreturn += <span class="hljs-string">"文件压缩失败"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="取得单个应用程序池"><a href="#取得单个应用程序池" class="headerlink" title="取得单个应用程序池"></a>取得单个应用程序池</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 取得单个应用程序池  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span>  </span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> ApplicationPool <span class="hljs-title">GetAppPool</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> appPoolName</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    ApplicationPool app = <span class="hljs-literal">null</span>;</span><br><span class="line">    <span class="hljs-keyword">var</span> appPools = <span class="hljs-keyword">new</span> DirectoryEntry(<span class="hljs-keyword">string</span>.Format(<span class="hljs-string">"IIS://&#123;0&#125;/W3SVC/AppPools"</span>, <span class="hljs-string">"localhost"</span>));</span><br><span class="line">    <span class="hljs-keyword">foreach</span> (DirectoryEntry entry <span class="hljs-keyword">in</span> appPools.Children)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (entry.Name == appPoolName)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">var</span> manager = <span class="hljs-keyword">new</span> ServerManager();</span><br><span class="line">            app = manager.ApplicationPools[appPoolName];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> app;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="共享读取文件，不占用文件"><a href="#共享读取文件，不占用文件" class="headerlink" title="共享读取文件，不占用文件"></a>共享读取文件，不占用文件</h2><figure class="highlight gams hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//设置文件共享方式为读写，FileShare.ReadWrite，这样的话，就可以打开了</span></span><br><span class="line"><span class="hljs-comment">//这个方法打开文件的时候是以只读共享的方式打开的，但若此文件已被一个拥有写权限的进程打开的话，就无法读取了，</span></span><br><span class="line"><span class="hljs-keyword">System</span>.IO.FileStream aFile = new <span class="hljs-keyword">System</span>.IO.FileStream(<span class="hljs-keyword">file</span>, <span class="hljs-keyword">System</span>.IO.FileMode.Open, <span class="hljs-keyword">System</span>.IO.FileAccess.Read, FileShare.ReadWrite);</span><br><span class="line">FileStream aFile = new FileStream(<span class="hljs-keyword">file</span>, FileMode.Open);</span><br></pre></td></tr></table></figure>
<h2 id="截取json字符，反序列化为model"><a href="#截取json字符，反序列化为model" class="headerlink" title="截取json字符，反序列化为model"></a>截取json字符，反序列化为model</h2><figure class="highlight cpp hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//截取json字符，反序列化为model</span></span><br><span class="line"><span class="hljs-keyword">int</span> IndexofA = strCurrentRow.IndexOf(<span class="hljs-string">"&#123;"</span>);</span><br><span class="line"><span class="hljs-keyword">int</span> IndexofB = strCurrentRow.LastIndexOf(<span class="hljs-string">"&#125;"</span>);</span><br><span class="line"><span class="hljs-built_in">string</span> contentList = strCurrentRow.Substring(IndexofA, IndexofB - IndexofA + <span class="hljs-number">1</span>);</span><br><span class="line">IncrementDataList.Add(javaScriptSerializer.Deserialize&lt;CountUserData&gt;(contentList));</span><br></pre></td></tr></table></figure>
<h2 id="字符串压缩"><a href="#字符串压缩" class="headerlink" title="字符串压缩"></a>字符串压缩</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 字符串压缩</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>The string.<span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="str"&gt;</span>String.<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">CompressString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> str</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">string</span> compressString = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-keyword">byte</span>[] compressBeforeByte = Encoding.UTF8.GetBytes(str);</span><br><span class="line">    <span class="hljs-keyword">byte</span>[] compressAfterByte = Compress(compressBeforeByte);</span><br><span class="line">    compressString = Convert.ToBase64String(compressAfterByte);</span><br><span class="line">    <span class="hljs-keyword">return</span> compressString;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 字节数组压缩  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strSource"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span>  </span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">Compress</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] data</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        MemoryStream ms = <span class="hljs-keyword">new</span> MemoryStream();</span><br><span class="line">        GZipStream zip = <span class="hljs-keyword">new</span> GZipStream(ms, CompressionMode.Compress, <span class="hljs-literal">true</span>);</span><br><span class="line">        zip.Write(data, <span class="hljs-number">0</span>, data.Length);</span><br><span class="line">        zip.Close();</span><br><span class="line">        <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[ms.Length];</span><br><span class="line">        ms.Position = <span class="hljs-number">0</span>;</span><br><span class="line">        ms.Read(buffer, <span class="hljs-number">0</span>, buffer.Length);</span><br><span class="line">        ms.Close();</span><br><span class="line">        <span class="hljs-keyword">return</span> buffer;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(e.Message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 字符串解压缩</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>The string.<span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="str"&gt;</span>String.<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">DecompressString</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> str</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">string</span> compressString = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-comment">//byte[] compressBeforeByte = Encoding.GetEncoding("UTF-8").GetBytes(str);    </span></span><br><span class="line">    <span class="hljs-keyword">byte</span>[] compressBeforeByte = Convert.FromBase64String(str);</span><br><span class="line">    <span class="hljs-keyword">byte</span>[] compressAfterByte = Decompress(compressBeforeByte);</span><br><span class="line">    compressString = Encoding.UTF8.GetString(compressAfterByte);</span><br><span class="line">    <span class="hljs-keyword">return</span> compressString;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 字节数组解压缩  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strSource"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span>  </span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span>  </span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">byte</span>[] <span class="hljs-title">Decompress</span>(<span class="hljs-params"><span class="hljs-keyword">byte</span>[] data</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        MemoryStream ms = <span class="hljs-keyword">new</span> MemoryStream(data);</span><br><span class="line">        GZipStream zip = <span class="hljs-keyword">new</span> GZipStream(ms, CompressionMode.Decompress, <span class="hljs-literal">true</span>);</span><br><span class="line">        MemoryStream msreader = <span class="hljs-keyword">new</span> MemoryStream();</span><br><span class="line">        <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[<span class="hljs-number">0x1000</span>];</span><br><span class="line">        <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">int</span> reader = zip.Read(buffer, <span class="hljs-number">0</span>, buffer.Length);</span><br><span class="line">            <span class="hljs-keyword">if</span> (reader &lt;= <span class="hljs-number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            msreader.Write(buffer, <span class="hljs-number">0</span>, reader);</span><br><span class="line">        &#125;</span><br><span class="line">        zip.Close();</span><br><span class="line">        ms.Close();</span><br><span class="line">        msreader.Position = <span class="hljs-number">0</span>;</span><br><span class="line">        buffer = msreader.ToArray();</span><br><span class="line">        msreader.Close();</span><br><span class="line">        <span class="hljs-keyword">return</span> buffer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception e)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> Exception(e.Message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="WPF-定时器"><a href="#WPF-定时器" class="headerlink" title="WPF 定时器"></a>WPF 定时器</h2><figure class="highlight haxe hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//WPF 定时器</span></span><br><span class="line">System.Timers.Timer timerLog = <span class="hljs-keyword">new</span> <span class="hljs-type">System</span>.Timers.Timer</span><br><span class="line">&#123;</span><br><span class="line">    Interval = <span class="hljs-number">1000</span> * <span class="hljs-number">60</span></span><br><span class="line">&#125;;</span><br><span class="line">timerLog.Elapsed += <span class="hljs-keyword">new</span> <span class="hljs-type">System</span>.Timers.ElapsedEventHandler(UpdateLog);<span class="hljs-comment">//到达时间的时候执行事件； </span></span><br><span class="line">timerLog.AutoReset = <span class="hljs-literal">true</span>;<span class="hljs-comment">//设置是执行一次（false）还是一直执行(true)； </span></span><br><span class="line">timerLog.Enabled = <span class="hljs-literal">true</span>;<span class="hljs-comment">//是否执行System.Timers.Timer.Elapsed事件；</span></span><br></pre></td></tr></table></figure>
<h2 id="输出文本日志记录"><a href="#输出文本日志记录" class="headerlink" title="输出文本日志记录"></a>输出文本日志记录</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 写发布日志</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="receiveString"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">WritePublishingLog</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> receiveString</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        StreamWriter LogWriter = <span class="hljs-keyword">new</span> StreamWriter(PUBLISHINGLOGURL, <span class="hljs-literal">true</span>, System.Text.Encoding.GetEncoding(<span class="hljs-string">"GB2312"</span>));</span><br><span class="line">        LogWriter.Write(DateTime.Now.ToLongDateString() + <span class="hljs-string">" "</span> + DateTime.Now.ToShortTimeString() + receiveString + <span class="hljs-string">"\n"</span>);</span><br><span class="line">        LogWriter.Close();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="拷贝文件到指定目录"><a href="#拷贝文件到指定目录" class="headerlink" title="拷贝文件到指定目录"></a>拷贝文件到指定目录</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 拷贝文件到指定目录</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sourceDirName"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="destDirName"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">CopyDirectory</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> sourceDirName, <span class="hljs-keyword">string</span> destDirName, <span class="hljs-keyword">bool</span> cover</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (!Directory.Exists(destDirName))</span><br><span class="line">        &#123;</span><br><span class="line">            Directory.CreateDirectory(destDirName);</span><br><span class="line">            File.SetAttributes(destDirName, File.GetAttributes(sourceDirName));</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (destDirName[destDirName.Length - <span class="hljs-number">1</span>] != Path.DirectorySeparatorChar)</span><br><span class="line">        &#123;</span><br><span class="line">            destDirName = destDirName + Path.DirectorySeparatorChar;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">string</span>[] files = Directory.GetFiles(sourceDirName);</span><br><span class="line">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> file <span class="hljs-keyword">in</span> files)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (File.Exists(destDirName + Path.GetFileName(file)) &amp;&amp; cover == <span class="hljs-literal">false</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            File.Copy(file, destDirName + Path.GetFileName(file), <span class="hljs-literal">true</span>);</span><br><span class="line">            File.SetAttributes(destDirName + Path.GetFileName(file), FileAttributes.Normal);</span><br><span class="line">            <span class="hljs-comment">// total++;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">string</span>[] dirs = Directory.GetDirectories(sourceDirName);</span><br><span class="line">        <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> dir <span class="hljs-keyword">in</span> dirs)</span><br><span class="line">        &#123;</span><br><span class="line">            CopyDirectory(dir, destDirName + Path.GetFileName(dir), <span class="hljs-literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception)</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="创建、删除文件夹"><a href="#创建、删除文件夹" class="headerlink" title="创建、删除文件夹"></a>创建、删除文件夹</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//创建文件夹</span></span><br><span class="line">Directory.CreateDirectory(<span class="hljs-string">@"D:\HisRelease"</span>);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> 直接删除指定目录下的所有文件及文件夹(保留目录)</span></span><br><span class="line"></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span>直接删除指定目录下的所有文件及文件夹(保留目录)</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="strPath"&gt;</span>文件夹路径<span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span>执行结果<span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">DeleteDir</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> file</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment">//去除文件夹和子文件的只读属性</span></span><br><span class="line">        <span class="hljs-comment">//去除文件夹的只读属性</span></span><br><span class="line">        System.IO.DirectoryInfo fileInfo = <span class="hljs-keyword">new</span> DirectoryInfo(file);</span><br><span class="line">        fileInfo.Attributes = FileAttributes.Normal &amp; FileAttributes.Directory;</span><br><span class="line">        <span class="hljs-comment">//去除文件的只读属性</span></span><br><span class="line">        System.IO.File.SetAttributes(file, System.IO.FileAttributes.Normal);</span><br><span class="line">        <span class="hljs-comment">//判断文件夹是否还存在</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (Directory.Exists(file))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (<span class="hljs-keyword">string</span> f <span class="hljs-keyword">in</span> Directory.GetFileSystemEntries(file))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-keyword">if</span> (File.Exists(f))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-comment">//如果有子文件删除文件</span></span><br><span class="line">                    File.Delete(f);</span><br><span class="line">                    Console.WriteLine(f);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="hljs-keyword">else</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-comment">//循环递归删除子文件夹</span></span><br><span class="line">                    DeleteDir(f);</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-comment">//删除空文件夹</span></span><br><span class="line"></span><br><span class="line">            Directory.Delete(file);</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span> (Exception ex) <span class="hljs-comment">// 异常处理</span></span><br><span class="line">    &#123;</span><br><span class="line">        Console.WriteLine(ex.Message.ToString());<span class="hljs-comment">// 异常信息</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br></pre></td></tr></table></figure>
<h2 id="读取wpf配置文件"><a href="#读取wpf配置文件" class="headerlink" title="读取wpf配置文件"></a>读取wpf配置文件</h2><figure class="highlight nix hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">#region 读取wpf配置文件获取三层地址</span></span><br><span class="line">string <span class="hljs-attr">His2Config</span> = Environment.CurrentDirectory + @<span class="hljs-string">"\His2.exe.config"</span>;</span><br><span class="line">System.Configuration.Configuration <span class="hljs-attr">_Configuration</span> = <span class="hljs-literal">null</span>;</span><br><span class="line"><span class="hljs-attr">_Configuration</span> = System.Configuration.ConfigurationManager.OpenMappedExeConfiguration(new ExeConfigurationFileMap() &#123; <span class="hljs-attr">ExeConfigFilename</span> = His2Config &#125;, ConfigurationUserLevel.None);</span><br><span class="line"><span class="hljs-attr">SancenAddress</span> = _Configuration.AppSettings.Settings[<span class="hljs-string">"Host"</span>].Value;</span><br><span class="line"><span class="hljs-comment">#endregion</span></span><br></pre></td></tr></table></figure>
<h2 id="wpf回归主线程"><a href="#wpf回归主线程" class="headerlink" title="wpf回归主线程"></a>wpf回归主线程</h2><figure class="highlight javascript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//wpf回归主线程</span></span><br><span class="line">ThreadPool.QueueUserWorkItem(delegate</span><br><span class="line">&#123;</span><br><span class="line">    SynchronizationContext.SetSynchronizationContext(<span class="hljs-keyword">new</span></span><br><span class="line">    DispatcherSynchronizationContext(System.Windows.Application.Current.Dispatcher));</span><br><span class="line">    SynchronizationContext.Current.Post(<span class="hljs-function"><span class="hljs-params">pl</span> =&gt;</span></span><br><span class="line">    &#123;</span><br><span class="line">        RequestService();</span><br><span class="line">    &#125;, <span class="hljs-literal">null</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h2 id="修改文件内容-多用于生成文件"><a href="#修改文件内容-多用于生成文件" class="headerlink" title="修改文件内容,多用于生成文件"></a>修改文件内容,多用于生成文件</h2><figure class="highlight armasm hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//修改文件内容</span><br><span class="line"><span class="hljs-keyword">string </span><span class="hljs-keyword">strFilePath </span>= destinationFile<span class="hljs-comment">;</span></span><br><span class="line"><span class="hljs-symbol">if</span> (File.Exists(<span class="hljs-keyword">strFilePath))</span></span><br><span class="line"><span class="hljs-keyword">&#123;</span></span><br><span class="line"><span class="hljs-keyword"> </span>   <span class="hljs-keyword">string </span><span class="hljs-keyword">strContent </span>= File.ReadAllText(<span class="hljs-keyword">strFilePath, </span>Encoding.Default)<span class="hljs-comment">;</span></span><br><span class="line">    <span class="hljs-keyword">strContent </span>= Regex.Replace(<span class="hljs-keyword">strContent, </span><span class="hljs-string">"NINEDATE"</span>, DateTime.Now.ToString())<span class="hljs-comment">;</span></span><br><span class="line">    <span class="hljs-keyword">strContent </span>= Regex.Replace(<span class="hljs-keyword">strContent, </span><span class="hljs-string">"NINEVER"</span>, newVersion)<span class="hljs-comment">;</span></span><br><span class="line">    <span class="hljs-keyword">strContent </span>= Regex.Replace(<span class="hljs-keyword">strContent, </span><span class="hljs-string">"NINEURL"</span>, CurrofficialFtpConnection.UpdateXmlAddress.Replace(<span class="hljs-comment">@"/Server.xml", "/update.zip"));</span></span><br><span class="line">    File.WriteAllText(<span class="hljs-keyword">strFilePath, </span><span class="hljs-keyword">strContent);</span></span><br><span class="line"><span class="hljs-keyword">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="task线程"><a href="#task线程" class="headerlink" title="task线程"></a>task线程</h2><figure class="highlight gradle hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//task线程</span></span><br><span class="line">var t6 = <span class="hljs-keyword">Task</span>.Factory.StartNew(() =&gt;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-keyword">Return</span> = DownFtpFile(spath, FtpUserName, FtpPassWord, ftpURI);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="hljs-keyword">Task</span>.WaitAll(t6);<span class="hljs-comment">//等待所有任务结束</span></span><br></pre></td></tr></table></figure>
<h2 id="下载FTP文件"><a href="#下载FTP文件" class="headerlink" title="下载FTP文件"></a>下载FTP文件</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 下载FTP文件</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="TempFolderPath"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="FtpUserName"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="FtpPassWord"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="ftpURI"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">string</span> <span class="hljs-title">DownFtpFile</span>(<span class="hljs-params"><span class="hljs-keyword">string</span> TempFolderPath, <span class="hljs-keyword">string</span> FtpUserName, <span class="hljs-keyword">string</span> FtpPassWord, <span class="hljs-keyword">string</span> ftpURI</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">string</span> returnMsg = <span class="hljs-string">""</span>;</span><br><span class="line">    <span class="hljs-comment">/*首先从配置文件读取ftp的登录信息*/</span></span><br><span class="line">    <span class="hljs-keyword">string</span> LocalFileExistsOperation = <span class="hljs-string">"write"</span>;</span><br><span class="line">    <span class="hljs-keyword">string</span> FtpPath = ftpURI;</span><br><span class="line">    Uri uri = <span class="hljs-keyword">new</span> Uri(FtpPath);</span><br><span class="line">    <span class="hljs-keyword">string</span> ss1 = System.IO.Path.GetFullPath(TempFolderPath);</span><br><span class="line">    <span class="hljs-keyword">string</span> ss2 = System.IO.Path.DirectorySeparatorChar.ToString();</span><br><span class="line">    <span class="hljs-keyword">string</span> ss3 = System.IO.Path.GetFileName(uri.LocalPath);</span><br><span class="line">    <span class="hljs-keyword">string</span> FileName = ss1 + ss2 + ss3;</span><br><span class="line">    <span class="hljs-comment">//创建一个文件流</span></span><br><span class="line">    FileStream fs = <span class="hljs-literal">null</span>;</span><br><span class="line">    Stream responseStream = <span class="hljs-literal">null</span>;</span><br><span class="line">    <span class="hljs-keyword">try</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment">//创建一个与FTP服务器联系的FtpWebRequest对象</span></span><br><span class="line">        FtpWebRequest request = (FtpWebRequest)WebRequest.Create(uri);</span><br><span class="line">        <span class="hljs-comment">//设置请求的方法是FTP文件下载</span></span><br><span class="line">        request.Method = WebRequestMethods.Ftp.DownloadFile;</span><br><span class="line">        <span class="hljs-comment">//连接登录FTP服务器</span></span><br><span class="line">        request.Credentials = <span class="hljs-keyword">new</span> NetworkCredential(FtpUserName, FtpPassWord);</span><br><span class="line">        <span class="hljs-comment">//获取一个请求响应对象</span></span><br><span class="line">        FtpWebResponse response = (FtpWebResponse)request.GetResponse();</span><br><span class="line">        <span class="hljs-comment">//获取请求的响应流</span></span><br><span class="line">        responseStream = response.GetResponseStream();</span><br><span class="line">        <span class="hljs-comment">//判断本地文件是否存在，如果存在，则打开和重写本地文件</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (File.Exists(FileName))</span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-keyword">if</span> (LocalFileExistsOperation == <span class="hljs-string">"write"</span>)</span><br><span class="line"></span><br><span class="line">            &#123;</span><br><span class="line">                fs = File.Open(FileName, FileMode.Open, FileAccess.ReadWrite);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-comment">//判断本地文件是否存在，如果不存在，则创建本地文件</span></span><br><span class="line">        <span class="hljs-keyword">else</span></span><br><span class="line"></span><br><span class="line">        &#123;</span><br><span class="line">            fs = File.Create(FileName);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span> (fs != <span class="hljs-literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">int</span> buffer_count = <span class="hljs-number">65536</span>;</span><br><span class="line">            <span class="hljs-keyword">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-keyword">byte</span>[buffer_count];</span><br><span class="line">            <span class="hljs-keyword">int</span> size = <span class="hljs-number">0</span>;</span><br><span class="line">            <span class="hljs-keyword">while</span> ((size = responseStream.Read(buffer, <span class="hljs-number">0</span>, buffer_count)) &gt; <span class="hljs-number">0</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                fs.Write(buffer, <span class="hljs-number">0</span>, size);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            fs.Flush();</span><br><span class="line">            fs.Close();</span><br><span class="line">            responseStream.Close();</span><br><span class="line">        &#125;</span><br><span class="line">        returnMsg = <span class="hljs-string">"下载成功"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">catch</span></span><br><span class="line">    &#123;</span><br><span class="line">        returnMsg = <span class="hljs-string">"下载失败"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">finally</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (fs != <span class="hljs-literal">null</span>)</span><br><span class="line">            fs.Close();</span><br><span class="line">        <span class="hljs-keyword">if</span> (responseStream != <span class="hljs-literal">null</span>)</span><br><span class="line">            responseStream.Close();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> returnMsg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="wpf文本框自动显示到最后一行"><a href="#wpf文本框自动显示到最后一行" class="headerlink" title="wpf文本框自动显示到最后一行"></a>wpf文本框自动显示到最后一行</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment">//wpf文本框自动显示到最后一行</span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ConInfo_TextChanged</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, TextChangedEventArgs e</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    ConInfo.ScrollToEnd();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="获取网页信息，验证登录demo"><a href="#获取网页信息，验证登录demo" class="headerlink" title="获取网页信息，验证登录demo"></a>获取网页信息，验证登录demo</h2><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">region</span> OA登录验证</span></span><br><span class="line"><span class="hljs-comment">//设置不弹出页面js错误信息</span></span><br><span class="line">OaWebBrowser.ScriptErrorsSuppressed = <span class="hljs-literal">true</span>;</span><br><span class="line"><span class="hljs-comment">//打开OA</span></span><br><span class="line">OaWebBrowser.Url = <span class="hljs-keyword">new</span> Uri(<span class="hljs-string">"https://oa.xyhis.com"</span>);</span><br><span class="line"><span class="hljs-meta">#<span class="hljs-meta-keyword">endregion</span></span></span><br><span class="line"><span class="hljs-keyword">this</span>.DataContext = LoginViewModel;</span><br><span class="line">txtAccount.Text = ConfigurationManager.AppSettings[<span class="hljs-string">"Account"</span>].ToString().Trim();</span><br><span class="line">txtPassword.Password = ConfigurationManager.AppSettings[<span class="hljs-string">"Pasd"</span>].ToString().Trim();</span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">BtnLogin_Click</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, RoutedEventArgs e</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (OaWebBrowser.ReadyState == WebBrowserReadyState.Complete &amp;&amp; OaWebBrowser.IsBusy == <span class="hljs-literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        HtmlElement txtUserName = OaWebBrowser.Document.All[<span class="hljs-string">"txtUserName"</span>];</span><br><span class="line">        txtUserName.SetAttribute(<span class="hljs-string">"value"</span>, <span class="hljs-keyword">this</span>.txtAccount.Text);</span><br><span class="line"></span><br><span class="line">        HtmlElement txtPwd = OaWebBrowser.Document.All[<span class="hljs-string">"txtPwd"</span>];</span><br><span class="line">        txtPwd.SetAttribute(<span class="hljs-string">"value"</span>, <span class="hljs-keyword">this</span>.txtPassword.Password);</span><br><span class="line"></span><br><span class="line">        HtmlElement ImageButton1 = OaWebBrowser.Document.All[<span class="hljs-string">"ImageButton1"</span>];</span><br><span class="line">        ImageButton1.InvokeMember(<span class="hljs-string">"click"</span>);</span><br><span class="line"></span><br><span class="line">        loginTimer.Interval = TimeSpan.FromMilliseconds(<span class="hljs-number">100</span>);</span><br><span class="line">        loginTimer.Tick += ValidateLogon;</span><br><span class="line">        loginTimer.Start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 登录验证</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="sender"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;param name="e"&gt;</span><span class="hljs-doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">ValidateLogon</span>(<span class="hljs-params"><span class="hljs-keyword">object</span> sender, EventArgs e</span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-keyword">if</span> (OaWebBrowser.ReadyState == WebBrowserReadyState.Complete &amp;&amp; OaWebBrowser.IsBusy == <span class="hljs-literal">false</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.OaWebBrowser.Url.AbsoluteUri == <span class="hljs-string">"https://oa.xyhis.com/Login.aspx"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            loginTimer.Stop();<span class="hljs-comment">//停止计时器</span></span><br><span class="line">            LoginViewModel.IsWait = <span class="hljs-literal">false</span>;</span><br><span class="line">            System.Windows.MessageBox.Show(<span class="hljs-string">"账号或密码错误，登录失败"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            loginTimer.Stop();<span class="hljs-comment">//停止计时器</span></span><br><span class="line">            Nine.UnitlLibrary.StaticGlobalVariable.UserName = txtAccount.Text.Trim();</span><br><span class="line">            Nine.UnitlLibrary.StaticGlobalVariable.Password = txtPassword.Password.Trim();</span><br><span class="line">            Configuration configuration = ConfigurationManager.OpenExeConfiguration(ConfigurationUserLevel.None);</span><br><span class="line"></span><br><span class="line">            <span class="hljs-keyword">if</span> (chkRemember.IsChecked == <span class="hljs-literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"Account"</span>].Value = txtAccount.Text;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"Pasd"</span>].Value = txtPassword.Password;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"Account"</span>].Value = <span class="hljs-string">""</span>;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"Pasd"</span>].Value = <span class="hljs-string">""</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (chkAutoLogin.IsChecked == <span class="hljs-literal">true</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"AutoLogin"</span>].Value = <span class="hljs-string">"true"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                configuration.AppSettings.Settings[<span class="hljs-string">"AutoLogin"</span>].Value = <span class="hljs-string">"false"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-keyword">if</span> (mainWindow == <span class="hljs-literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                mainWindow = <span class="hljs-keyword">new</span> MainWindow();</span><br><span class="line">                mainWindow.Show();</span><br><span class="line">                <span class="hljs-keyword">this</span>.Hide();</span><br><span class="line">            &#125;</span><br><span class="line">            configuration.Save();</span><br><span class="line">            ConfigurationManager.RefreshSection(<span class="hljs-string">"appSettings"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="获取本机IP地址（当前使用v4地址）"><a href="#获取本机IP地址（当前使用v4地址）" class="headerlink" title="获取本机IP地址（当前使用v4地址）"></a>获取本机IP地址（当前使用v4地址）</h3><figure class="highlight cs hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> 获取本机IP地址（当前使用v4地址）  20180205 Ninth</span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="hljs-comment"><span class="hljs-doctag">///</span> <span class="hljs-doctag">&lt;returns&gt;</span><span class="hljs-doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">string</span> <span class="hljs-title">GetLocalIP</span>(<span class="hljs-params"></span>)</span></span><br><span class="line"><span class="hljs-function"></span>&#123;</span><br><span class="line">    <span class="hljs-comment">//获取说有网卡信息</span></span><br><span class="line">    NetworkInterface[] nics = NetworkInterface.GetAllNetworkInterfaces();</span><br><span class="line">    <span class="hljs-keyword">foreach</span> (NetworkInterface adapter <span class="hljs-keyword">in</span> nics)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-comment">//判断是否为以太网卡</span></span><br><span class="line">        <span class="hljs-comment">//Wireless80211         无线网卡    Ppp     宽带连接</span></span><br><span class="line">        <span class="hljs-comment">//Ethernet              以太网卡   </span></span><br><span class="line">        <span class="hljs-comment">//这里篇幅有限贴几个常用的，其他的返回值大家就自己百度吧！</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (adapter.NetworkInterfaceType == NetworkInterfaceType.Ethernet)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-comment">//获取以太网卡网络接口信息</span></span><br><span class="line">            IPInterfaceProperties ip = adapter.GetIPProperties();</span><br><span class="line">            <span class="hljs-comment">//获取单播地址集</span></span><br><span class="line">            UnicastIPAddressInformationCollection ipCollection = ip.UnicastAddresses;</span><br><span class="line">            <span class="hljs-keyword">foreach</span> (UnicastIPAddressInformation ipadd <span class="hljs-keyword">in</span> ipCollection)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-comment">//InterNetwork    IPV4地址      InterNetworkV6        IPV6地址</span></span><br><span class="line">                <span class="hljs-comment">//Max            MAX 位址</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (ipadd.Address.AddressFamily == AddressFamily.InterNetwork)</span><br><span class="line">                <span class="hljs-comment">//判断是否为ipv4</span></span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-keyword">return</span> ipadd.Address.ToString();<span class="hljs-comment">//获取ip</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-10-16T02:30:33.000Z">2019-10-16</time>
                
                    <span class="display-none-class">a0001ea6ed1f1c62608f15c7dca1d95f</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=a0001ea6ed1f1c62608f15c7dca1d95f>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 947 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/10/16/VisualsvnServer跨版本库迁移目录且保留日志/">VisualsvnServer跨版本库迁移目录且保留日志</a>
            
        </h1>
        <div class="content">
            <p>有这样一个问题，<br>现在有一份代码code在版本库Nine.net/Nine.Basic/下，现在想把它移动到JamBlog/source/下</p>
<h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><figure class="highlight stylus hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">├─VisualsvnServer</span><br><span class="line">│  ├─Nine.net</span><br><span class="line">│  │    │─Nine.Basic</span><br><span class="line">│  │    └─xxxx</span><br><span class="line">│  ├─JamBlog</span><br><span class="line">│  │    └─source</span><br></pre></td></tr></table></figure>
<h2 id="需要达到的目的"><a href="#需要达到的目的" class="headerlink" title="需要达到的目的"></a>需要达到的目的</h2><h3 id="1-将代码移动到新的版本库"><a href="#1-将代码移动到新的版本库" class="headerlink" title="1. 将代码移动到新的版本库"></a>1. 将代码移动到新的版本库</h3><h3 id="2-将原始的提交记录保留"><a href="#2-将原始的提交记录保留" class="headerlink" title="2. 将原始的提交记录保留"></a>2. 将原始的提交记录保留</h3><p>本来打算用svn move来做的，后来发现因为是不同的版本库，所以这个想法走不通</p>
<p>一下以Windows为例，使用的是windows10<br><figure class="highlight vbscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">主要分为几个步骤:</span><br><span class="line"></span><br><span class="line">I 进入VisualSVN <span class="hljs-built_in">Server</span>，服务端，迁移命令都是<span class="hljs-built_in">server</span>端执行</span><br><span class="line">II 导出需要迁移的代码库</span><br><span class="line">III 过滤导出代码库中需要的代码</span><br><span class="line">IV 导入过滤后的代码进入新的代码库</span><br></pre></td></tr></table></figure></p>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="I-进入VisualSVN-Server安装目录，"><a href="#I-进入VisualSVN-Server安装目录，" class="headerlink" title="I 进入VisualSVN Server安装目录，"></a>I 进入VisualSVN Server安装目录，</h3><h4 id="注意，svn命令是在svn-client端执行的，svnadmin-svnserver-svndumpfilter都是在svn-server端执行的"><a href="#注意，svn命令是在svn-client端执行的，svnadmin-svnserver-svndumpfilter都是在svn-server端执行的" class="headerlink" title="注意，svn命令是在svn client端执行的，svnadmin svnserver svndumpfilter都是在svn server端执行的"></a>注意，svn命令是在svn client端执行的，svnadmin svnserver svndumpfilter都是在svn server端执行的</h4><p>命令：<br><figure class="highlight livescript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd C:<span class="hljs-string">\Program</span> Files<span class="hljs-string">\VisualSVN</span> Server<span class="hljs-string">\bin</span></span><br></pre></td></tr></table></figure></p>
<h3 id="II-导出需要迁移的代码库"><a href="#II-导出需要迁移的代码库" class="headerlink" title="II 导出需要迁移的代码库"></a>II 导出需要迁移的代码库</h3><p>命令：<br><figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">指令格式：svnadmin dump 版本库源目录 &gt; 目标文件</span><br><span class="line"></span><br><span class="line">svnadmin dump D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\N</span>ine.net &gt; Nine.netBack</span><br><span class="line"></span><br><span class="line">命令解析：</span><br><span class="line">将“D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\N</span>ine.net”整个版本库导出至“Nine.netBack”这个文件中；“prog1”文件存放在当前目录，且不含扩展名；</span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">Windows下，“版本库源目录”必须为包含format文件的目录，是存放文件的实际物理路径，非SVN服务器的相对路径；</span><br></pre></td></tr></table></figure></p>
<h3 id="III-过滤导出代码库中需要的代码"><a href="#III-过滤导出代码库中需要的代码" class="headerlink" title="III 过滤导出代码库中需要的代码"></a>III 过滤导出代码库中需要的代码</h3><h4 id="如果需要转移的源目录非根目录的，可使用svndumpfilter指令，将实际要转移的源目录从刚刚生成的文件中提取出来，并放到一个新文件中；在目标目录下导入时则使用这个新生成的文件；否则转移目录就是根目录则跳过这一步"><a href="#如果需要转移的源目录非根目录的，可使用svndumpfilter指令，将实际要转移的源目录从刚刚生成的文件中提取出来，并放到一个新文件中；在目标目录下导入时则使用这个新生成的文件；否则转移目录就是根目录则跳过这一步" class="headerlink" title="如果需要转移的源目录非根目录的，可使用svndumpfilter指令，将实际要转移的源目录从刚刚生成的文件中提取出来，并放到一个新文件中；在目标目录下导入时则使用这个新生成的文件；否则转移目录就是根目录则跳过这一步"></a>如果需要转移的源目录非根目录的，可使用svndumpfilter指令，将实际要转移的源目录从刚刚生成的文件中提取出来，并放到一个新文件中；在目标目录下导入时则使用这个新生成的文件；否则转移目录就是根目录则跳过这一步</h4><figure class="highlight css hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-selector-tag">svndumpfilter</span> <span class="hljs-selector-tag">include</span> <span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.Basic</span> &lt;<span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.netBack</span>&gt; <span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.netBack2</span></span><br><span class="line"></span><br><span class="line">命令解析</span><br><span class="line">将<span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.net</span>中的<span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.Basic</span>过滤出来，<span class="hljs-selector-tag">svndumpfilter</span> <span class="hljs-selector-tag">include</span>表示只保留制定的目录和文件,这句命令中指定的目录和文件就是<span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.Basic</span></span><br><span class="line"></span><br><span class="line">注意：</span><br><span class="line">此时过滤后生成了新的文件<span class="hljs-selector-tag">Nine</span><span class="hljs-selector-class">.netBack2</span>，执行最后导入的时候要注意别导入了整个版本库的原文件</span><br></pre></td></tr></table></figure>
<h3 id="IV-导入过滤后的代码进入新的代码库"><a href="#IV-导入过滤后的代码进入新的代码库" class="headerlink" title="IV 导入过滤后的代码进入新的代码库"></a>IV 导入过滤后的代码进入新的代码库</h3><figure class="highlight taggerscript hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1.</span><br><span class="line">svnadmin load D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\J</span>amBlog &lt; Nine.netBack2</span><br><span class="line">2.</span><br><span class="line">svnadmin load D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\J</span>amBlog --parent-dir source &lt; Nine.netBack2</span><br><span class="line"></span><br><span class="line">命令解析：</span><br><span class="line">两个命令二选一，本文章中需要导入到source目录，则选择第二个命令</span><br><span class="line">1.将“Nine.netBack2”整个版本库导入至“D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\J</span>amBlog” JamBlog” 这个版本库的根目录下 ；</span><br><span class="line">2.将“Nine.netBack2”整个版本库导入至“D:<span class="hljs-symbol">\同</span>步文件夹<span class="hljs-symbol">\O</span>neDrive<span class="hljs-symbol">\R</span>epositories<span class="hljs-symbol">\J</span>amBlog” JamBlog” 这个版本库的source目录下 ；</span><br><span class="line">3.--parent-dir source 导入到 source 目录，此为版本库下的目录，若果是source下的xxx目录</span><br><span class="line">则需要在此更改目录--parent-dir source/xxx,而不是在前面版本库处增加子级目录</span><br><span class="line">注意：</span><br><span class="line">导入到指定目录的时候需要先进行手动创建该目录，例如这里是导入到source目录，则我们需要先创建source目录</span><br><span class="line">***svn中区分大小写，svn中区分大小写，svn中区分大小写</span><br></pre></td></tr></table></figure>
<h4 id="至此成功把代码库成功跨版本版本库迁移，且保留相关的提交记录"><a href="#至此成功把代码库成功跨版本版本库迁移，且保留相关的提交记录" class="headerlink" title="至此成功把代码库成功跨版本版本库迁移，且保留相关的提交记录"></a>至此成功把代码库成功跨版本版本库迁移，且保留相关的提交记录</h4><h5 id="参考文章："><a href="#参考文章：" class="headerlink" title="参考文章："></a>参考文章：</h5><p><a href="https://blog.csdn.net/helenfish/article/details/9984555" target="_blank" rel="noopener">https://blog.csdn.net/helenfish/article/details/9984555</a><br><a href="https://blog.csdn.net/tianshijianbing1989/article/details/41980675" target="_blank" rel="noopener">https://blog.csdn.net/tianshijianbing1989/article/details/41980675</a></p>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>








    <div class="card">
    
    <div class="card-content article ">
        
        <div class="level article-meta is-size-7 is-uppercase is-mobile is-overflow-x-auto">
            <div class="level-left">
                
                <time class="level-item has-text-grey" datetime="2019-09-28T16:21:43.000Z">2019-09-29</time>
                
                    <span class="display-none-class">5ea68d1592a809d0559ad0b488c6bf4f</span>
                    <img class="not-gallery-item" src="/images/chat.svg">&nbsp;<span class="level-item has-text-grey" id=5ea68d1592a809d0559ad0b488c6bf4f>99+</span></img>
                
                
                <div class="level-item">
                <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                </div>
                
                
                <span class="level-item has-text-grey">
                    
                    
                    6 分钟 读完 (大约 858 个字)
                </span>
                
                
            </div>
        </div>
        
        <h1 class="title is-size-3 is-size-4-mobile has-text-weight-normal">
            
                <a class="has-link-black-ter" href="/2019/09/29/C-反射调用Demo/">C#反射调用Demo</a>
            
        </h1>
        <div class="content">
            <figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="hljs-type">ThreadPool</span>.<span class="hljs-type">QueueUserWorkItem</span>(delegate</span><br><span class="line">&#123;</span><br><span class="line">    <span class="hljs-type">SynchronizationContext</span>.<span class="hljs-type">SetSynchronizationContext</span>(<span class="hljs-keyword">new</span></span><br><span class="line">    <span class="hljs-type">DispatcherSynchronizationContext</span>(<span class="hljs-type">System</span>.<span class="hljs-type">Windows</span>.<span class="hljs-type">Application</span>.<span class="hljs-type">Current</span>.<span class="hljs-type">Dispatcher</span>));</span><br><span class="line">    <span class="hljs-type">SynchronizationContext</span>.<span class="hljs-type">Current</span>.<span class="hljs-type">Post</span>(pl =&gt;</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="hljs-keyword">try</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-comment">//输入</span></span><br><span class="line">            string tableMc=tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>();</span><br><span class="line">            <span class="hljs-comment">//反射dll path</span></span><br><span class="line">            string dllPath=<span class="hljs-string">"AppDomain.CurrentDomain.BaseDirectory +"</span><span class="hljs-type">XYHis</span>.<span class="hljs-type">BusinessRedis</span>.<span class="hljs-string">dll""</span>; </span><br><span class="line">            <span class="hljs-comment">//获取类型，参数（名称空间+类）   </span></span><br><span class="line">            string dllClassName = <span class="hljs-string">"XYHis.BusinessRedis.InRedisCacheService"</span>;</span><br><span class="line">            <span class="hljs-comment">//使用Assembly类加载程序集(dll文件地址)，</span></span><br><span class="line">            <span class="hljs-type">Assembly</span> assembly = <span class="hljs-type">Assembly</span>.<span class="hljs-type">LoadFile</span>(dllPath);</span><br><span class="line">            <span class="hljs-comment">//获取类型，参数（名称空间+类）   </span></span><br><span class="line">            <span class="hljs-type">Type</span> <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= assembly.<span class="hljs-type">GetType</span>(dllClassName);</span><br><span class="line">            <span class="hljs-comment">//获取所有的公共方法</span></span><br><span class="line">            <span class="hljs-type">MethodInfo</span>[] methodsInfo = <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethods</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">            <span class="hljs-comment">//创建该对象的实例，object类型，参数（名称空间+类）   </span></span><br><span class="line">            <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">instance</span> </span>= assembly.<span class="hljs-type">CreateInstance</span>(dllClassName);</span><br><span class="line">            <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, <span class="hljs-string">"开始更新"</span> + tableMc);</span><br><span class="line">            <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; methodsInfo.<span class="hljs-type">Length</span>; i++)<span class="hljs-comment">//遍历所有的方法</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="hljs-comment">//如果名字等于输入的方法名</span></span><br><span class="line">                <span class="hljs-keyword">if</span> (methodsInfo[i].<span class="hljs-type">Name</span> == tableMc)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-comment">//获取方法的所有参数</span></span><br><span class="line">                    <span class="hljs-type">ParameterInfo</span>[] arrayParamsInfo = methodsInfo[i].<span class="hljs-type">GetParameters</span>();</span><br><span class="line">                    <span class="hljs-comment">//无参执行</span></span><br><span class="line">                    <span class="hljs-keyword">if</span> (arrayParamsInfo.<span class="hljs-type">Length</span> == <span class="hljs-number">0</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="hljs-comment">//执行方法</span></span><br><span class="line">                        <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">returnValer</span> </span>= <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethod</span>(<span class="hljs-params">tableMc</span>).<span class="hljs-title">Invoke</span>(<span class="hljs-params">instance, null</span>)</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="hljs-keyword">else</span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="hljs-comment">//参数类型 设置方法中的参数类型，Type[]类型；如有多个参数可以追加多个   </span></span><br><span class="line">                        <span class="hljs-type">Type</span>[] arrayParamsType = <span class="hljs-keyword">new</span> <span class="hljs-type">Type</span>[arrayParamsInfo.<span class="hljs-type">Length</span>];</span><br><span class="line">                        <span class="hljs-comment">//参数值</span></span><br><span class="line">                        <span class="hljs-class"><span class="hljs-keyword">object</span>[] <span class="hljs-title">arrayParamsValue</span> </span>= <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">object</span>[arrayParamsInfo.<span class="hljs-type">Length</span>]</span>;</span><br><span class="line">                        <span class="hljs-comment">//添加参数，参数赋默认值</span></span><br><span class="line">                        <span class="hljs-keyword">for</span> (int j = <span class="hljs-number">0</span>; j &lt; arrayParamsInfo.<span class="hljs-type">Length</span>; j++)</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="hljs-comment">//获取参数类型设置，等同于//params_type[j] = Type.GetType("System.String");</span></span><br><span class="line">                            arrayParamsType[j] = </span><br><span class="line">                                    <span class="hljs-type">Type</span>.<span class="hljs-type">GetType</span>(arrayParamsInfo[j].<span class="hljs-type">ParameterType</span>.<span class="hljs-type">ToString</span>());</span><br><span class="line">                            <span class="hljs-comment">//参数赋默认值</span></span><br><span class="line">                            arrayParamsValue[j] = <span class="hljs-type">GetDefaultValueForType</span>(arrayParamsType[j]);</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="hljs-comment">//执行方法</span></span><br><span class="line">                        <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">returnValer</span> </span>=</span><br><span class="line">                         <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethod</span>(<span class="hljs-params">tableMc, arrayParamsType</span>).<span class="hljs-title">Invoke</span>(<span class="hljs-params">instance, arrayParamsValue</span>)</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, <span class="hljs-string">"更新成功"</span> + tableMc);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="hljs-keyword">catch</span> (<span class="hljs-type">Exception</span> err)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="hljs-comment">//System.Windows.MessageBox.Show(err.Message);</span></span><br><span class="line">            <span class="hljs-comment">//ConsleLogInfo("更新失败", "更新失败" + tableMc);</span></span><br><span class="line">            <span class="hljs-comment">//ConsleLogInfo("=========更新失败=========", err.Message.ToString());</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, <span class="hljs-literal">null</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="上一段是单个DLL反射使用，由于项目需要，更改了一下可以实现遍历所有的dll，文章中用字符串数组代替了"><a href="#上一段是单个DLL反射使用，由于项目需要，更改了一下可以实现遍历所有的dll，文章中用字符串数组代替了" class="headerlink" title="上一段是单个DLL反射使用，由于项目需要，更改了一下可以实现遍历所有的dll，文章中用字符串数组代替了"></a>上一段是单个DLL反射使用，由于项目需要，更改了一下可以实现遍历所有的dll，文章中用字符串数组代替了</h3><figure class="highlight scala hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-type">ThreadPool</span>.<span class="hljs-type">QueueUserWorkItem</span>(delegate</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="hljs-type">SynchronizationContext</span>.<span class="hljs-type">SetSynchronizationContext</span>(<span class="hljs-keyword">new</span></span><br><span class="line">                    <span class="hljs-type">DispatcherSynchronizationContext</span>(<span class="hljs-type">System</span>.<span class="hljs-type">Windows</span>.<span class="hljs-type">Application</span>.<span class="hljs-type">Current</span>.<span class="hljs-type">Dispatcher</span>));</span><br><span class="line">                    <span class="hljs-type">SynchronizationContext</span>.<span class="hljs-type">Current</span>.<span class="hljs-type">Post</span>(pl =&gt;</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="hljs-keyword">try</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            int <span class="hljs-type">Success</span> = <span class="hljs-number">0</span>;</span><br><span class="line">                            string[] classNameAll = <span class="hljs-keyword">new</span> string[<span class="hljs-number">3</span>];</span><br><span class="line">                            classNameAll[<span class="hljs-number">0</span>] = <span class="hljs-string">"XYHis.BusinessRedis.InRedisCacheService"</span>;</span><br><span class="line">                            classNameAll[<span class="hljs-number">1</span>] = <span class="hljs-string">"XYHis.BusinessRedis.RmRedisCacheService"</span>;</span><br><span class="line">                            classNameAll[<span class="hljs-number">2</span>] = <span class="hljs-string">"XYHis.BusinessRedis.OuRedisCacheService"</span>;</span><br><span class="line">                            <span class="hljs-keyword">for</span> (int x = <span class="hljs-number">0</span>; x &lt; classNameAll.<span class="hljs-type">Length</span>; x++)</span><br><span class="line">                            &#123;</span><br><span class="line">                                <span class="hljs-comment">//获取类型，参数（名称空间+类）   </span></span><br><span class="line">                                string dllClassName = classNameAll[x];</span><br><span class="line">                                <span class="hljs-comment">//使用Assembly类加载程序集(dll文件地址)，</span></span><br><span class="line">                                <span class="hljs-type">Assembly</span> assembly = <span class="hljs-type">Assembly</span>.<span class="hljs-type">LoadFile</span>(<span class="hljs-type">AppDomain</span>.<span class="hljs-type">CurrentDomain</span>.<span class="hljs-type">BaseDirectory</span> + <span class="hljs-string">"XYHis.BusinessRedis.dll"</span>);</span><br><span class="line">                                <span class="hljs-comment">//获取类型，参数（名称空间+类）   </span></span><br><span class="line">                                <span class="hljs-type">Type</span> <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= assembly.<span class="hljs-type">GetType</span>(dllClassName);</span><br><span class="line">                                <span class="hljs-comment">//获取所有的公共方法</span></span><br><span class="line">                                <span class="hljs-type">MethodInfo</span>[] methodsInfo = <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethods</span>(<span class="hljs-params"></span>)</span>;</span><br><span class="line">                                <span class="hljs-keyword">for</span> (int n = <span class="hljs-number">0</span>; n &lt; methodsInfo.<span class="hljs-type">Length</span>; n++)</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="hljs-keyword">if</span> (methodsInfo[n].<span class="hljs-type">Name</span> == tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>())</span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="hljs-type">Success</span> = <span class="hljs-number">1</span>;</span><br><span class="line">                                        <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, <span class="hljs-string">"查找结果："</span>+tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>() + <span class="hljs-string">"()为His业务数据缓存"</span>);</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="hljs-keyword">if</span> (<span class="hljs-type">Success</span>==<span class="hljs-number">1</span>)</span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="hljs-comment">//创建该对象的实例，object类型，参数（名称空间+类）   </span></span><br><span class="line">                                    <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">instance</span> </span>= assembly.<span class="hljs-type">CreateInstance</span>(dllClassName);</span><br><span class="line">                                    <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, <span class="hljs-string">"开始更新"</span> + tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>());</span><br><span class="line">                                    <span class="hljs-keyword">for</span> (int i = <span class="hljs-number">0</span>; i &lt; methodsInfo.<span class="hljs-type">Length</span>; i++)<span class="hljs-comment">//遍历所有的方法</span></span><br><span class="line">                                    &#123;</span><br><span class="line">                                        <span class="hljs-keyword">if</span> (methodsInfo[i].<span class="hljs-type">Name</span> == tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>())<span class="hljs-comment">//如果名字等于输入的方法名</span></span><br><span class="line">                                        &#123;</span><br><span class="line">                                            <span class="hljs-type">ParameterInfo</span>[] arrayParamsInfo = methodsInfo[i].<span class="hljs-type">GetParameters</span>();<span class="hljs-comment">//获取方法的所有参数</span></span><br><span class="line">                                            <span class="hljs-keyword">if</span> (arrayParamsInfo.<span class="hljs-type">Length</span> == <span class="hljs-number">0</span>)<span class="hljs-comment">//无参执行</span></span><br><span class="line">                                            &#123;</span><br><span class="line">                                                <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">returnValer</span> </span>= <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethod</span>(<span class="hljs-params">tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>(</span>)).<span class="hljs-title">Invoke</span>(<span class="hljs-params">instance, null</span>)</span>;<span class="hljs-comment">//执行方法</span></span><br><span class="line">                                            &#125;</span><br><span class="line">                                            <span class="hljs-keyword">else</span></span><br><span class="line">                                            &#123;</span><br><span class="line">                                                <span class="hljs-comment">//参数类型 设置方法中的参数类型，Type[]类型；如有多个参数可以追加多个   </span></span><br><span class="line">                                                <span class="hljs-type">Type</span>[] arrayParamsType = <span class="hljs-keyword">new</span> <span class="hljs-type">Type</span>[arrayParamsInfo.<span class="hljs-type">Length</span>];</span><br><span class="line">                                                <span class="hljs-comment">//参数值</span></span><br><span class="line">                                                <span class="hljs-class"><span class="hljs-keyword">object</span>[] <span class="hljs-title">arrayParamsValue</span> </span>= <span class="hljs-keyword">new</span> <span class="hljs-class"><span class="hljs-keyword">object</span>[arrayParamsInfo.<span class="hljs-type">Length</span>]</span>;</span><br><span class="line">                                                <span class="hljs-comment">//添加参数，参数赋默认值</span></span><br><span class="line">                                                <span class="hljs-keyword">for</span> (int j = <span class="hljs-number">0</span>; j &lt; arrayParamsInfo.<span class="hljs-type">Length</span>; j++)</span><br><span class="line">                                                &#123;</span><br><span class="line">                                                    <span class="hljs-comment">//获取参数类型设置，等同于//params_type[j] = Type.GetType("System.String");</span></span><br><span class="line">                                                    arrayParamsType[j] = <span class="hljs-type">Type</span>.<span class="hljs-type">GetType</span>(arrayParamsInfo[j].<span class="hljs-type">ParameterType</span>.<span class="hljs-type">ToString</span>());</span><br><span class="line">                                                    <span class="hljs-comment">//参数赋默认值</span></span><br><span class="line">                                                    arrayParamsValue[j] = <span class="hljs-type">GetDefaultValueForType</span>(arrayParamsType[j]);</span><br><span class="line">                                                &#125;</span><br><span class="line">                                                <span class="hljs-comment">//执行方法</span></span><br><span class="line">                                                <span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">returnValer</span> </span>= <span class="hljs-class"><span class="hljs-keyword">type</span>.<span class="hljs-title">GetMethod</span>(<span class="hljs-params">tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>(</span>), <span class="hljs-title">arrayParamsType</span>).<span class="hljs-title">Invoke</span>(<span class="hljs-params">instance, arrayParamsValue</span>)</span>;</span><br><span class="line">                                            &#125;</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                    <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, <span class="hljs-string">"更新成功"</span> + tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>());</span><br><span class="line">                                    <span class="hljs-type">Lith</span>.<span class="hljs-type">Value</span> = <span class="hljs-number">100</span>;</span><br><span class="line">                                    <span class="hljs-keyword">return</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                                <span class="hljs-keyword">else</span></span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"状态信息"</span>, classNameAll[x]+<span class="hljs-string">"找不到"</span> +tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>() + <span class="hljs-string">"()方法，继续往下查找"</span>);</span><br><span class="line">                                    <span class="hljs-keyword">continue</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="hljs-keyword">catch</span> (<span class="hljs-type">Exception</span> err)</span><br><span class="line">                        &#123;</span><br><span class="line"></span><br><span class="line">                            <span class="hljs-comment">//System.Windows.MessageBox.Show(err.Message);</span></span><br><span class="line">                            <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"更新失败"</span>, <span class="hljs-string">"更新失败"</span> + tableName.<span class="hljs-type">Text</span>.<span class="hljs-type">Trim</span>());</span><br><span class="line">                            <span class="hljs-type">ConsleLogInfo</span>(<span class="hljs-string">"=========更新失败========="</span>, err.<span class="hljs-type">Message</span>.<span class="hljs-type">ToString</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;, <span class="hljs-literal">null</span>);</span><br></pre></td></tr></table></figure>

        </div>
        <!-- 部分参考自https://www.alphalxy.com/2019/03/customize-icarus/ -->
        
        
        
        
    </div>
</div>









    
<div class="card card-transparent">
    <nav class="pagination is-centered" role="navigation" aria-label="pagination">
        <div class="pagination-previous is-invisible is-hidden-mobile">
            <a class="is-flex-grow has-text-black-ter" href="/page/0/">上一页</a>
        </div>
        <div class="pagination-next">
            <a class="is-flex-grow has-text-black-ter" href="/page/2/">下一页</a>
        </div>
        <ul class="pagination-list is-hidden-mobile">
            
            <li><a class="pagination-link is-current" href="/">1</a></li>
            
            <li><a class="pagination-link has-text-black-ter" href="/page/2/">2</a></li>
            
        </ul>
    </nav>
</div>
</div>
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-1 column-left is-sticky">
    
        
<div class="card widget">
    <div class="card-content">
        <nav class="level">
            <div class="level-item has-text-centered">
                <div>
                    
                        <img class="image is-128x128 has-mb-6" src="http://hemrj.cn/avatar.jpg" alt="Jam He">
                    
                    
                    <p class="is-size-4 is-block">
                        Jam He
                    </p>
                    
                    
                    <p class="is-size-6 is-block">
                        为什么要努力，为了自己吹下的牛逼
                    </p>
                    
                    
                    <p class="is-size-6 is-flex is-flex-center has-text-grey">
                        <i class="fas fa-map-marker-alt has-mr-7"></i>
                        <span>China,GuangDong</span>
                    </p>
                    
                </div>
            </div>
        </nav>
        <nav class="level is-mobile">
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        文章
                    </p>
                    <p class="title has-text-weight-normal">
                        20
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        分类
                    </p>
                    <p class="title has-text-weight-normal">
                        3
                    </p>
                </div>
            </div>
            <div class="level-item has-text-centered is-marginless">
                <div>
                    <p class="heading">
                        标签
                    </p>
                    <p class="title has-text-weight-normal">
                        33
                    </p>
                </div>
            </div>
        </nav>
        <div class="level">
            <a class="level-item button is-link is-rounded" href="https://weibo.com/u/3050419984" target="_blank">
                关注我</a>
        </div>
        
        
        <div class="level is-mobile">
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Github" href="https://github.com/removeif">
                
                <i class="fab fa-github"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Facebook" href="https://github.com/removeif ">
                
                <i class="fab fa-facebook"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Twitter" href="https://github.com/removeif ">
                
                <i class="fab fa-twitter"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="Dribbble" href="https://github.com/removeif ">
                
                <i class="fab fa-dribbble"></i>
                
            </a>
            
            <a class="level-item button is-white is-marginless" target="_blank"
                title="RSS" href="/atom.xml">
                
                <i class="fas fa-rss"></i>
                
            </a>
            
        </div>
        
    </div>
</div>
    
        
    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            链接
        </h3>
        <ul class="menu-list">
        
            <li>
                <a class="level is-mobile" href="https://weibo.com/u/3050419984" target="_blank">
                    <span class="level-left">
                        <span class="level-item">微博</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">weibo.com</span>
                    </span>
                </a>
            </li>
        
            <li>
                <a class="level is-mobile" href="https://www.cnblogs.com/KongkOngL/" target="_blank">
                    <span class="level-left">
                        <span class="level-item">博客园</span>
                    </span>
                    <span class="level-right">
                        <span class="level-item tag">www.cnblogs.com</span>
                    </span>
                </a>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
        

<div class="card widget">
    <div class="card-content">
        <div class="menu text-desc">
        <h3 class="menu-label">
            通知
        </h3>
        <ul class="menu-list">
        
            <li>
                    <span class="level-left">
                        <span class="level-item notice-item">2019.09.01：加入伪娘看板</span>
                    </span>
            </li>
        
            <li>
                    <span class="level-left">
                        <span class="level-item notice-item">2019.08.11：网站升级</span>
                    </span>
            </li>
        
            <li>
                    <span class="level-left">
                        <span class="level-item notice-item">2019.02.01：采用Icarus主题</span>
                    </span>
            </li>
        
            <li>
                    <span class="level-left">
                        <span class="level-item notice-item">2018.11.11：建站</span>
                    </span>
            </li>
        
        </ul>
        </div>
    </div>
</div>


    
    
</div>

                
                




<div class="column is-4-tablet is-4-desktop is-3-widescreen  has-order-3 column-right ">
    
        
    <div class="card widget">
        <div class="card-content" id="body_hot_comment">
        <h3 class="menu-label">最新评论<br>加载中，稍等几秒...</h3>
        </div>
    </div>

    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            最新文章
        </h3>
        
        <article class="media">
            
            <a href="/2019/10/17/WindowsOS系统整合，创建自己的系统盘/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="WindowsOS系统整合，创建自己的系统盘">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-17T01:29:27.000Z">2019-10-17</time></div>
                    <a href="/2019/10/17/WindowsOS系统整合，创建自己的系统盘/" class="has-link-black-ter is-size-6">WindowsOS系统整合，创建自己的系统盘</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/10/17/制作Visual Studio 2017离线包/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="制作Visual Studio 2017离线包">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-17T01:27:25.000Z">2019-10-17</time></div>
                    <a href="/2019/10/17/制作Visual Studio 2017离线包/" class="has-link-black-ter is-size-6">制作Visual Studio 2017离线包</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/实用教程/">实用教程</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/10/16/C-发送邮件DEMO/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="C#发送邮件DEMO">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-16T07:44:20.000Z">2019-10-16</time></div>
                    <a href="/2019/10/16/C-发送邮件DEMO/" class="has-link-black-ter is-size-6">C#发送邮件DEMO</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/10/16/SqlLite数据库帮助类和基本DEMO/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="SqlLite数据库帮助类和基本DEMO">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-16T07:05:13.000Z">2019-10-16</time></div>
                    <a href="/2019/10/16/SqlLite数据库帮助类和基本DEMO/" class="has-link-black-ter is-size-6">SqlLite数据库帮助类和基本DEMO</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                    </p>
                </div>
            </div>
        </article>
        
        <article class="media">
            
            <a href="/2019/10/16/WPF属性双向绑定/" class="media-left">
                <p class="image is-64x64">
                    <img class="thumbnail" src="/images/thumbnail.svg" alt="WPF属性双向绑定">
                </p>
            </a>
            
            <div class="media-content">
                <div class="content">
                    <div><time class="has-text-grey is-size-7 is-uppercase" datetime="2019-10-16T06:25:43.000Z">2019-10-16</time></div>
                    <a href="/2019/10/16/WPF属性双向绑定/" class="has-link-black-ter is-size-6">WPF属性双向绑定</a>
                    <p class="is-size-7 is-uppercase">
                        <a class="has-link-grey -link" href="/categories/Codeing/">Codeing</a>
                    </p>
                </div>
            </div>
        </article>
        
    </div>
</div>

    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
        <h3 class="menu-label">
            归档
        </h3>
        <ul class="menu-list">
        
        <li>
            <a class="level is-marginless" href="/archives/2019/10/">
                <span class="level-start">
                    <span class="level-item">十月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">8</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/09/">
                <span class="level-start">
                    <span class="level-item">九月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/06/">
                <span class="level-start">
                    <span class="level-item">六月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">4</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2019/04/">
                <span class="level-start">
                    <span class="level-item">四月 2019</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">3</span>
                </span>
            </a>
        </li>
        
        <li>
            <a class="level is-marginless" href="/archives/2017/10/">
                <span class="level-start">
                    <span class="level-item">十月 2017</span>
                </span>
                <span class="level-end">
                    <span class="level-item tag">2</span>
                </span>
            </a>
        </li>
        
        </ul>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                分类
            </h3>
            <ul class="menu-list">
            <li>
        <a class="level is-marginless" href="/categories/Codeing/">
            <span class="level-start">
                <span class="level-item">Codeing</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">10</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/个人/">
            <span class="level-start">
                <span class="level-item">个人</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">1</span>
            </span>
        </a></li><li>
        <a class="level is-marginless" href="/categories/实用教程/">
            <span class="level-start">
                <span class="level-item">实用教程</span>
            </span>
            <span class="level-end">
                <span class="level-item tag">9</span>
            </span>
        </a></li>
            </ul>
        </div>
    </div>
</div>
    
        <div class="card widget">
    <div class="card-content">
        <div class="menu">
            <h3 class="menu-label">
                标签
            </h3>
            <div class="field is-grouped is-grouped-multiline">
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Blog/">
                        <span class="tag">Blog</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/C/">
                        <span class="tag">C#</span>
                        <span class="tag is-grey">10</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/DEMO/">
                        <span class="tag">DEMO</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Git/">
                        <span class="tag">Git</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Hexo/">
                        <span class="tag">Hexo</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Http/">
                        <span class="tag">Http</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Java/">
                        <span class="tag">Java</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MVVM/">
                        <span class="tag">MVVM</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Maven/">
                        <span class="tag">Maven</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/MyBatis/">
                        <span class="tag">MyBatis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/NodeJs/">
                        <span class="tag">NodeJs</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Oracle/">
                        <span class="tag">Oracle</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Proxy/">
                        <span class="tag">Proxy</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Redis/">
                        <span class="tag">Redis</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SSM/">
                        <span class="tag">SSM</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SVN/">
                        <span class="tag">SVN</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Service/">
                        <span class="tag">Service</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/SpringMVC/">
                        <span class="tag">SpringMVC</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Visualsvn-Server/">
                        <span class="tag">Visualsvn Server</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/WPF/">
                        <span class="tag">WPF</span>
                        <span class="tag is-grey">2</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/Windows/">
                        <span class="tag">Windows</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/代码块/">
                        <span class="tag">代码块</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/实用工具/">
                        <span class="tag">实用工具</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/实用教程/">
                        <span class="tag">实用教程</span>
                        <span class="tag is-grey">12</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/情感/">
                        <span class="tag">情感</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/日记/">
                        <span class="tag">日记</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/激活/">
                        <span class="tag">激活</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统优化/">
                        <span class="tag">系统优化</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/系统配置/">
                        <span class="tag">系统配置</span>
                        <span class="tag is-grey">3</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/编程开发/">
                        <span class="tag">编程开发</span>
                        <span class="tag is-grey">9</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/软件安装/">
                        <span class="tag">软件安装</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/部署实施/">
                        <span class="tag">部署实施</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
                <div class="control">
                    <a class="tags has-addons" href="/tags/随笔/">
                        <span class="tag">随笔</span>
                        <span class="tag is-grey">1</span>
                    </a>
                </div>
                
            </div>
        </div>
    </div>
</div>
    
        
<div class="card widget">
    <div class="card-content">
        <h3 class="menu-label">
            标签云
        </h3>
        <a href="/tags/Blog/" style="font-size: 10px;">Blog</a> <a href="/tags/C/" style="font-size: 18px;">C#</a> <a href="/tags/DEMO/" style="font-size: 10px;">DEMO</a> <a href="/tags/Git/" style="font-size: 12px;">Git</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Http/" style="font-size: 10px;">Http</a> <a href="/tags/Java/" style="font-size: 10px;">Java</a> <a href="/tags/MVVM/" style="font-size: 12px;">MVVM</a> <a href="/tags/Maven/" style="font-size: 10px;">Maven</a> <a href="/tags/MyBatis/" style="font-size: 10px;">MyBatis</a> <a href="/tags/NodeJs/" style="font-size: 10px;">NodeJs</a> <a href="/tags/Oracle/" style="font-size: 10px;">Oracle</a> <a href="/tags/Proxy/" style="font-size: 10px;">Proxy</a> <a href="/tags/Redis/" style="font-size: 10px;">Redis</a> <a href="/tags/SSM/" style="font-size: 10px;">SSM</a> <a href="/tags/SVN/" style="font-size: 10px;">SVN</a> <a href="/tags/Service/" style="font-size: 10px;">Service</a> <a href="/tags/SpringMVC/" style="font-size: 10px;">SpringMVC</a> <a href="/tags/Visualsvn-Server/" style="font-size: 10px;">Visualsvn Server</a> <a href="/tags/WPF/" style="font-size: 12px;">WPF</a> <a href="/tags/Windows/" style="font-size: 10px;">Windows</a> <a href="/tags/代码块/" style="font-size: 14px;">代码块</a> <a href="/tags/实用工具/" style="font-size: 10px;">实用工具</a> <a href="/tags/实用教程/" style="font-size: 20px;">实用教程</a> <a href="/tags/情感/" style="font-size: 10px;">情感</a> <a href="/tags/日记/" style="font-size: 10px;">日记</a> <a href="/tags/激活/" style="font-size: 10px;">激活</a> <a href="/tags/系统优化/" style="font-size: 10px;">系统优化</a> <a href="/tags/系统配置/" style="font-size: 14px;">系统配置</a> <a href="/tags/编程开发/" style="font-size: 16px;">编程开发</a> <a href="/tags/软件安装/" style="font-size: 10px;">软件安装</a> <a href="/tags/部署实施/" style="font-size: 10px;">部署实施</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
    </div>
</div>

    
    
</div>

                
            </div>
        </div>
    </section>
    <footer class="footer">
    <div class="container">
        <div class="level">
            <div class="level-start has-text-centered-mobile">
                <a class="footer-logo is-block has-mb-6" href="/">
                
                    <img src="/images/logo.svg" alt="Jam&#39;s blog" height="28">
                
                </a>
                <p class="is-size-7">
                &copy; 2019 Jam He
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a
                        href="http://github.com/ppoffice/hexo-theme-icarus" target="_blank">Icarus</a>,Modify by <a href="https://github.com/removeif">removeif</a>&nbsp;
                
                <br>
                &copy; 版权说明：[本网站所有内容均收集于互联网或自己创作,<br>&nbsp;&nbsp;&nbsp;&nbsp;方便于网友与自己学习交流，如有侵权，请<a href="https://removeif.github.io/message/" target="_blank">留言</a>，立即处理]
                <br>
                <span id="busuanzi_container_site_uv">
                      ❤️感谢 <span id="busuanzi_value_site_uv"></span> 小伙伴的 
                </span>
                 <span id="busuanzi_value_site_pv"></span> 次光临 ❤️
                 
                </p>
            </div>
            <div class="level-end">
            
                <div class="field has-addons is-flex-center-mobile has-mt-5-mobile is-flex-wrap is-flex-middle">
                
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Creative Commons" href="https://weibo.com/u/3050419984">
                        
                        <i class="fab fa-creative-commons"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Attribution 4.0 International" href="https://weibo.com/u/3050419984">
                        
                        <i class="fab fa-creative-commons-by"></i>
                        
                    </a>
                </p>
                
                <p class="control">
                    <a class="button is-white is-large" target="_blank" title="Download on GitHub" href="https://github.com/removeif">
                        
                        <i class="fab fa-github"></i>
                        
                    </a>
                </p>
                
                </div>
            
            </div>
        </div>
    </div>
</footer>
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script>
<script>moment.locale("zh-CN");</script>


    
    
    
    <script src="/js/animation.js"></script>
    

    
    
    
    <script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script>
    <script src="/js/gallery.js" defer></script>
    

    
    

<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update
            my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        });
    });
</script>


    
    
<script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    MathJax.Hub.Config({
        'HTML-CSS': {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
});
</script>

    
    

<a id="back-to-top" title="回到顶端" href="javascript:;">
    <i class="fas fa-chevron-up"></i>
</a>
<script src="/js/back-to-top.js" defer></script>


    
    

    
    
    
    

    
    
    
    
    
    <script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script>
    <script src="/js/clipboard.js" defer></script>
    

    
    
    

    


<script src="/js/main.js" defer></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="想要查找什么..." />
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: '文章',
                PAGES: '页面',
                CATEGORIES: '分类',
                TAGS: '标签',
                UNTITLED: '(无标题)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js" defer></script>
<link rel="stylesheet" href="/css/search.css">
<link rel="stylesheet" href="/css/insight.css">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript" defer src="/js/global-hot-data.js"></script>
    <script type="text/javascript" async="" src="/live2d/autoload.js"></script>
<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"model":{"scale":1,"hHeadPos":0.5,"vHeadPos":0.618},"display":{"superSample":2,"width":150,"height":300,"position":"right","hOffset":0,"vOffset":-20},"mobile":{"show":true,"scale":0.5},"react":{"opacityDefault":0.7,"opacityOnHover":0.2},"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>